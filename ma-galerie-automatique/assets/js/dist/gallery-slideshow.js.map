{
  "version": 3,
  "sources": ["../src/shared/sprintf.js", "../src/shared/icons.js", "../src/shared/focus.js", "../src/shared/swiper.js", "../src/shared/index.js", "../src/gallery-slideshow.js"],
  "sourcesContent": ["const TOKEN_REGEX = /%(\\d+\\$)?[sd]/g;\n\nconst createFallbackSprintf = () => (format, ...args) => {\n    let autoIndex = 0;\n\n    return String(format).replace(TOKEN_REGEX, (match, position) => {\n        let argIndex;\n        const type = match.charAt(match.length - 1);\n\n        if (position) {\n            const numericIndex = parseInt(position.slice(0, -1), 10);\n\n            if (Number.isNaN(numericIndex) || numericIndex <= 0) {\n                return '';\n            }\n\n            argIndex = numericIndex - 1;\n        } else {\n            argIndex = autoIndex;\n            autoIndex += 1;\n        }\n\n        const value = argIndex >= 0 && argIndex < args.length ? args[argIndex] : undefined;\n\n        if (type === 'd') {\n            const coerced = parseInt(value, 10);\n            return Number.isNaN(coerced) ? '' : String(coerced);\n        }\n\n        if (typeof value === 'undefined') {\n            return '';\n        }\n\n        return String(value);\n    });\n};\n\nexport const createSprintf = (i18n) => {\n    if (i18n && typeof i18n.sprintf === 'function') {\n        return i18n.sprintf;\n    }\n\n    return createFallbackSprintf();\n};\n\nexport const createTranslate = (i18n) => {\n    if (i18n && typeof i18n.__ === 'function') {\n        return i18n.__;\n    }\n\n    return (text) => text;\n};\n\nexport const resolveI18n = (globalObject) => {\n    if (!globalObject || typeof globalObject !== 'object') {\n        return null;\n    }\n\n    if (globalObject.wp && globalObject.wp.i18n) {\n        return globalObject.wp.i18n;\n    }\n\n    return null;\n};\n\nexport const getSharedI18n = () => resolveI18n(typeof window !== 'undefined' ? window : globalThis);\n\nexport const getSharedSprintf = () => createSprintf(getSharedI18n());\n\nexport const getSharedTranslate = () => createTranslate(getSharedI18n());\n\nexport default {\n    createSprintf,\n    createTranslate,\n    getSharedI18n,\n    getSharedSprintf,\n    getSharedTranslate,\n};\n", "const SHARE_ICON_LIBRARY = {\n    facebook: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.99 3.66 9.12 8.44 9.88v-6.99H8.08V12h2.36V9.88c0-2.33 1.38-3.62 3.5-3.62 0.72 0 1.48 0.13 1.48 0.13v1.63h-0.83c-0.82 0-1.08 0.51-1.08 1.04V12h1.84l-0.29 1.89h-1.55v6.99C18.34 21.12 22 16.99 22 12z' },\n        ],\n    },\n    twitter: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M22.46 6c-0.77 0.35-1.6 0.59-2.46 0.69a4.29 4.29 0 0 0 1.88-2.37 8.59 8.59 0 0 1-2.72 1.04 4.28 4.28 0 0 0-7.3 3.9 12.13 12.13 0 0 1-8.82-4.47 4.28 4.28 0 0 0 1.33 5.72 4.25 4.25 0 0 1-1.94-0.54v0.05a4.28 4.28 0 0 0 3.43 4.2 4.3 4.3 0 0 1-1.93 0.07 4.28 4.28 0 0 0 4 2.97 8.58 8.58 0 0 1-5.3 1.83 12.1 12.1 0 0 0 6.56 1.92c7.88 0 12.2-6.53 12.2-12.2 0-0.19-0.01-0.39-0.01-0.58A8.7 8.7 0 0 0 22.46 6z' },\n        ],\n    },\n    linkedin: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M20.45 3H3.55A1.55 1.55 0 0 0 2 4.55v14.9C2 20.3 2.7 21 3.55 21h16.9c0.85 0 1.55-0.7 1.55-1.55V4.55C22 3.7 21.3 3 20.45 3zM8.34 18H5.67V9.67h2.67V18zM7 8.5a1.55 1.55 0 1 1 0-3.1 1.55 1.55 0 0 1 0 3.1zM18.33 18h-2.67v-4.1c0-0.98-0.02-2.24-1.36-2.24-1.36 0-1.56 1.06-1.56 2.16V18h-2.67V9.67h2.56v1.14h0.04c0.36-0.68 1.24-1.4 2.56-1.4 2.74 0 3.25 1.8 3.25 4.13V18z' },\n        ],\n    },\n    pinterest: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M12 2C6.48 2 2 6.31 2 11.42c0 3.89 2.68 7.23 6.44 8.41-0.09-0.71-0.17-1.8 0.03-2.58 0.18-0.77 1.15-4.9 1.15-4.9s-0.29-0.58-0.29-1.45c0-1.36 0.79-2.37 1.78-2.37 0.84 0 1.24 0.63 1.24 1.38 0 0.84-0.53 2.09-0.8 3.25-0.23 1 0.5 1.81 1.48 1.81 1.78 0 3.14-1.87 3.14-4.57 0-2.39-1.72-4.07-4.18-4.07-2.85 0-4.52 2.14-4.52 4.35 0 0.86 0.33 1.79 0.74 2.29 0.08 0.1 0.09 0.19 0.07 0.29-0.07 0.31-0.23 1-0.26 1.13-0.04 0.18-0.14 0.22-0.32 0.13-1.2-0.56-1.95-2.29-1.95-3.68 0-3 2.18-5.76 6.29-5.76 3.3 0 5.87 2.35 5.87 5.5 0 3.28-2.06 5.93-4.92 5.93-0.96 0-1.86-0.5-2.17-1.08l-0.59 2.24c-0.21 0.83-0.78 1.87-1.16 2.5 0.87 0.27 1.78 0.42 2.72 0.42 5.52 0 10-4.31 10-9.42C22 6.31 17.52 2 12 2z' },\n        ],\n    },\n    whatsapp: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M20.52 3.48A10.5 10.5 0 0 0 2.47 13.3l-1.45 5.28 5.4-1.41A10.5 10.5 0 1 0 20.52 3.48zm-8.5 17.54a8.75 8.75 0 0 1-4.46-1.22l-0.32-0.19-3.21 0.84 0.86-3.13-0.2-0.32a8.75 8.75 0 1 1 7.33 3.99zm4.78-6.53c-0.26-0.13-1.53-0.76-1.77-0.84-0.24-0.09-0.41-0.13-0.58 0.13-0.17 0.26-0.66 0.84-0.8 1.02-0.15 0.17-0.29 0.2-0.55 0.07-0.26-0.13-1.09-0.4-2.07-1.3-0.76-0.68-1.27-1.52-1.42-1.78-0.15-0.26-0.02-0.4 0.11-0.53 0.11-0.11 0.26-0.29 0.39-0.43 0.13-0.15 0.17-0.26 0.26-0.43 0.09-0.17 0.04-0.32-0.02-0.45-0.07-0.13-0.58-1.39-0.8-1.91-0.21-0.5-0.43-0.43-0.58-0.43-0.15 0-0.32-0.02-0.49-0.02-0.17 0-0.43 0.06-0.66 0.32-0.24 0.26-0.89 0.87-0.89 2.13s0.91 2.47 1.03 2.64c0.13 0.17 1.79 2.73 4.34 3.83 0.61 0.26 1.08 0.41 1.45 0.53 0.61 0.19 1.16 0.16 1.6 0.1 0.49-0.07 1.53-0.62 1.75-1.22 0.21-0.6 0.21-1.11 0.15-1.22-0.06-0.1-0.24-0.16-0.5-0.29z' },\n        ],\n    },\n    telegram: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M21.5 2.5l-19 7.5c-1.3 0.52-1.29 2.35 0.02 2.85l4.8 1.9 1.9 4.8c0.5 1.31 2.34 1.32 2.85 0.02l7.5-19c0.42-1.06-0.64-2.12-1.67-1.67zM10 14l-1 4-1.5-3.8 8.3-6.2-5.8 6z' },\n        ],\n    },\n    email: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 2-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z' },\n        ],\n    },\n    link: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M10.59 13.41a1 1 0 0 1 0-1.41l2-2a1 1 0 1 1 1.41 1.41l-2 2a1 1 0 0 1-1.41 0zm-2.83 2.83a3 3 0 0 1 0-4.24l2-2a3 3 0 0 1 4.24 0 1 1 0 0 1-1.41 1.41 1 1 0 0 0-1.41 0l-2 2a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l1-1a1 1 0 1 1 1.41 1.41l-1 1a3 3 0 0 1-4.24 0zm8.48-8.48a3 3 0 0 0-4.24 0l-1 1a1 1 0 0 1-1.41-1.41l1-1a5 5 0 1 1 7.07 7.07l-2 2a5 5 0 0 1-7.07 0 1 1 0 0 1 1.41-1.41 3 3 0 0 0 4.24 0l2-2a3 3 0 0 0 0-4.24z' },\n        ],\n    },\n    generic: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z' },\n            { d: 'M13 17h-2v-2h2zm0-4h-2V7h2z' },\n        ],\n    },\n    copy: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z' },\n        ],\n    },\n    download: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M5 20h14v-2H5v2zm7-16v9l3.5-3.5 1.42 1.42L12 17l-4.92-4.92L8.5 10.66 12 14.17V4z' },\n        ],\n    },\n    native: {\n        viewBox: '0 0 24 24',\n        paths: [\n            { d: 'M18 16.08c-0.76 0-1.44 0.3-1.96 0.77L8.91 12.7c0.05-0.23 0.09-0.46 0.09-0.7s-0.04-0.47-0.09-0.7l7.02-4.11A2.99 2.99 0 0 0 18 7.91c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 0.24 0.03 0.47 0.09 0.7L8.07 9.7A2.99 2.99 0 0 0 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c0.79 0 1.5-0.31 2.03-0.82l7.05 4.12c-0.06 0.23-0.08 0.46-0.08 0.7 0 1.65 1.34 2.99 3 2.99s3-1.34 3-2.99-1.34-3-3-3z' },\n        ],\n    },\n};\n\nexport const sanitizeIconKey = (value) => {\n    if (typeof value !== 'string') {\n        return '';\n    }\n\n    return value.trim().toLowerCase().replace(/[^a-z0-9_-]/g, '');\n};\n\nconst getDefinition = (iconKey) => {\n    const sanitizedKey = sanitizeIconKey(iconKey);\n\n    if (sanitizedKey && SHARE_ICON_LIBRARY[sanitizedKey]) {\n        return SHARE_ICON_LIBRARY[sanitizedKey];\n    }\n\n    return SHARE_ICON_LIBRARY.generic;\n};\n\nexport const createSvgElement = (doc, tag, attributes = {}) => {\n    if (!doc || typeof doc.createElementNS !== 'function') {\n        return null;\n    }\n\n    const element = doc.createElementNS('http://www.w3.org/2000/svg', tag);\n\n    Object.keys(attributes).forEach((attribute) => {\n        element.setAttribute(attribute, attributes[attribute]);\n    });\n\n    return element;\n};\n\nexport const createIconSvg = (doc, iconKey) => {\n    const definition = getDefinition(iconKey);\n    const svg = createSvgElement(doc, 'svg', {\n        viewBox: definition.viewBox,\n        fill: 'currentColor',\n        'aria-hidden': 'true',\n        focusable: 'false',\n    });\n\n    if (!svg) {\n        return null;\n    }\n\n    if (Array.isArray(definition.paths)) {\n        definition.paths.forEach((pathDefinition) => {\n            const path = createSvgElement(doc, 'path', pathDefinition);\n\n            if (path) {\n                svg.appendChild(path);\n            }\n        });\n    }\n\n    return svg;\n};\n\nexport const createIconPreview = (doc, iconKey, { wrapperTag = 'span', wrapperClass = '' } = {}) => {\n    if (!doc || typeof doc.createElement !== 'function') {\n        return null;\n    }\n\n    const wrapper = doc.createElement(wrapperTag);\n\n    if (wrapperClass) {\n        wrapper.className = wrapperClass;\n    }\n\n    const svg = createIconSvg(doc, iconKey);\n\n    if (!svg) {\n        return null;\n    }\n\n    wrapper.appendChild(svg);\n\n    return wrapper;\n};\n\nexport const getIconLibrary = () => ({ ...SHARE_ICON_LIBRARY });\n\nexport default {\n    createIconPreview,\n    createIconSvg,\n    getIconLibrary,\n    sanitizeIconKey,\n};\n", "let focusSupportsOptionsCache = null;\n\nexport const detectFocusOptionsSupport = () => {\n    if (focusSupportsOptionsCache !== null) {\n        return focusSupportsOptionsCache;\n    }\n\n    focusSupportsOptionsCache = false;\n\n    const doc = typeof window !== 'undefined' ? window.document : null;\n\n    if (\n        !doc ||\n        typeof doc.createElement !== 'function' ||\n        typeof window.HTMLElement === 'undefined' ||\n        !window.HTMLElement.prototype ||\n        typeof window.HTMLElement.prototype.focus !== 'function'\n    ) {\n        return focusSupportsOptionsCache;\n    }\n\n    const testElement = doc.createElement('button');\n    const root = doc.body || doc.documentElement;\n\n    try {\n        testElement.type = 'button';\n\n        if (root && typeof root.appendChild === 'function') {\n            root.appendChild(testElement);\n        }\n\n        window.HTMLElement.prototype.focus.call(testElement, {\n            get preventScroll() {\n                focusSupportsOptionsCache = true;\n                return true;\n            },\n        });\n    } catch (error) {\n        focusSupportsOptionsCache = false;\n    } finally {\n        if (testElement.parentNode && typeof testElement.parentNode.removeChild === 'function') {\n            testElement.parentNode.removeChild(testElement);\n        }\n    }\n\n    return focusSupportsOptionsCache;\n};\n\nexport const safeFocus = (element, options = { preventScroll: true }) => {\n    if (!element || typeof element.focus !== 'function') {\n        return;\n    }\n\n    const canUseOptions = options && detectFocusOptionsSupport();\n\n    if (canUseOptions) {\n        try {\n            element.focus(options);\n            return;\n        } catch (error) {\n            // Ignore and fall back to focusing without options.\n        }\n    }\n\n    element.focus();\n};\n\nexport const exposeOnWindow = () => {\n    if (typeof window === 'undefined') {\n        return;\n    }\n\n    if (!window.mgaFocusUtils || typeof window.mgaFocusUtils !== 'object') {\n        window.mgaFocusUtils = {};\n    }\n\n    window.mgaFocusUtils.detectFocusOptionsSupport = detectFocusOptionsSupport;\n    window.mgaFocusUtils.safeFocus = safeFocus;\n};\n\nexport default {\n    detectFocusOptionsSupport,\n    safeFocus,\n    exposeOnWindow,\n};\n", "const DEFAULT_TIMEOUT = 12000;\n\nconst getTimestamp = (global) => {\n    if (global && global.performance && typeof global.performance.now === 'function') {\n        return global.performance.now();\n    }\n\n    return Date.now();\n};\n\nconst getDocument = (global) => (global && global.document) || null;\n\nconst getMetricsStore = (global) => {\n    if (!global) {\n        return null;\n    }\n\n    if (!global.mgaSwiperMetrics || typeof global.mgaSwiperMetrics !== 'object') {\n        global.mgaSwiperMetrics = { events: [] };\n    }\n\n    if (!Array.isArray(global.mgaSwiperMetrics.events)) {\n        global.mgaSwiperMetrics.events = [];\n    }\n\n    return global.mgaSwiperMetrics;\n};\n\nconst recordMetric = (global, namespace, event, detail) => {\n    const store = getMetricsStore(global);\n\n    if (!store) {\n        return;\n    }\n\n    store.events.push({\n        namespace: namespace || 'default',\n        event,\n        detail: detail || {},\n        timestamp: getTimestamp(global),\n    });\n\n    if (typeof global.dispatchEvent === 'function') {\n        try {\n            const customEvent = new global.CustomEvent('mga:swiper-metric', {\n                detail: {\n                    namespace: namespace || 'default',\n                    event,\n                    payload: detail || {},\n                },\n            });\n            global.dispatchEvent(customEvent);\n        } catch (error) {\n            // Ignore CustomEvent support issues.\n        }\n    }\n};\n\nconst normalizeAttempts = (config) => {\n    if (!config || typeof config !== 'object') {\n        return [];\n    }\n\n    const rawAttempts = Array.isArray(config.attempts) ? config.attempts : [];\n\n    return rawAttempts\n        .map((attempt) => {\n            if (!attempt || typeof attempt !== 'object') {\n                return null;\n            }\n\n            if (attempt.enabled === false) {\n                return null;\n            }\n\n            const key = typeof attempt.key === 'string' && attempt.key ? attempt.key : 'fallback';\n            const js = attempt.js && typeof attempt.js === 'object' ? attempt.js : {};\n            const css = attempt.css && typeof attempt.css === 'object' ? attempt.css : null;\n            const inject = attempt.inject !== false;\n\n            const jsSrc = typeof js.src === 'string' && js.src ? js.src : '';\n\n            if (!jsSrc) {\n                return null;\n            }\n\n            return {\n                key,\n                label: typeof attempt.label === 'string' && attempt.label ? attempt.label : key,\n                js: {\n                    src: jsSrc,\n                    integrity: typeof js.integrity === 'string' && js.integrity ? js.integrity : null,\n                    crossOrigin: typeof js.crossOrigin === 'string' && js.crossOrigin ? js.crossOrigin : null,\n                    referrerPolicy: typeof js.referrerPolicy === 'string' && js.referrerPolicy ? js.referrerPolicy : null,\n                },\n                css: css && typeof css.href === 'string' && css.href\n                    ? {\n                        href: css.href,\n                        integrity: typeof css.integrity === 'string' && css.integrity ? css.integrity : null,\n                        crossOrigin: typeof css.crossOrigin === 'string' && css.crossOrigin ? css.crossOrigin : null,\n                        referrerPolicy: typeof css.referrerPolicy === 'string' && css.referrerPolicy ? css.referrerPolicy : null,\n                    }\n                    : null,\n                timeout: typeof attempt.timeout === 'number' && attempt.timeout > 0\n                    ? attempt.timeout\n                    : DEFAULT_TIMEOUT,\n                inject,\n            };\n        })\n        .filter(Boolean);\n};\n\nconst loadStylesheet = (global, attempt, namespace) => {\n    if (!attempt || !attempt.css) {\n        return Promise.resolve();\n    }\n\n    const doc = getDocument(global);\n\n    if (!doc) {\n        return Promise.resolve();\n    }\n\n    const existing = Array.from(doc.querySelectorAll('link[rel=\"stylesheet\"]'))\n        .find((link) => link.href === attempt.css.href);\n\n    if (existing) {\n        return Promise.resolve(existing);\n    }\n\n    return new Promise((resolve, reject) => {\n        const link = doc.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = attempt.css.href;\n        link.dataset.mgaSwiperSource = attempt.key;\n\n        if (attempt.css.integrity) {\n            link.integrity = attempt.css.integrity;\n        }\n\n        if (attempt.css.crossOrigin) {\n            link.crossOrigin = attempt.css.crossOrigin;\n        } else if (attempt.css.integrity) {\n            link.crossOrigin = 'anonymous';\n        }\n\n        if (attempt.css.referrerPolicy) {\n            link.referrerPolicy = attempt.css.referrerPolicy;\n        }\n\n        link.onload = () => {\n            recordMetric(global, namespace, 'css_load_success', { source: attempt.key });\n            resolve(link);\n        };\n\n        link.onerror = () => {\n            recordMetric(global, namespace, 'css_load_error', { source: attempt.key });\n            reject(new Error('Stylesheet load error'));\n        };\n\n        doc.head.appendChild(link);\n        recordMetric(global, namespace, 'css_load_start', { source: attempt.key, href: attempt.css.href });\n    });\n};\n\nconst loadScript = (global, attempt, namespace) => {\n    if (!attempt || !attempt.js || !attempt.js.src) {\n        return Promise.reject(new Error('Invalid attempt configuration'));\n    }\n\n    const doc = getDocument(global);\n\n    if (!doc) {\n        return Promise.reject(new Error('Document unavailable'));\n    }\n\n    const existing = Array.from(doc.querySelectorAll('script'))\n        .find((script) => script.src === attempt.js.src && !script.hasAttribute('data-mga-swiper-failed'));\n\n    if (existing) {\n        return new Promise((resolve, reject) => {\n            if (typeof global.Swiper === 'function') {\n                existing.setAttribute('data-mga-swiper-loaded', 'true');\n                recordMetric(global, namespace, 'js_already_available', { source: attempt.key });\n                resolve(existing);\n                return;\n            }\n\n            if (typeof existing.hasAttribute === 'function' && existing.hasAttribute('data-mga-swiper-loaded')) {\n                resolve(existing);\n                return;\n            }\n\n            existing.addEventListener('load', () => {\n                existing.setAttribute('data-mga-swiper-loaded', 'true');\n                resolve(existing);\n            });\n            existing.addEventListener('error', () => {\n                existing.setAttribute('data-mga-swiper-failed', 'true');\n                reject(new Error('Existing script failed'));\n            });\n\n            recordMetric(global, namespace, 'js_existing_observed', { source: attempt.key });\n        });\n    }\n\n    return new Promise((resolve, reject) => {\n        const script = doc.createElement('script');\n        script.src = attempt.js.src;\n        script.async = false;\n        script.dataset.mgaSwiperSource = attempt.key;\n\n        if (attempt.js.integrity) {\n            script.integrity = attempt.js.integrity;\n        }\n\n        if (attempt.js.crossOrigin) {\n            script.crossOrigin = attempt.js.crossOrigin;\n        } else if (attempt.js.integrity) {\n            script.crossOrigin = 'anonymous';\n        }\n\n        if (attempt.js.referrerPolicy) {\n            script.referrerPolicy = attempt.js.referrerPolicy;\n        }\n\n        let timeoutId = null;\n\n        const cleanup = () => {\n            if (timeoutId) {\n                global.clearTimeout(timeoutId);\n                timeoutId = null;\n            }\n        };\n\n        script.onload = () => {\n            cleanup();\n            script.setAttribute('data-mga-swiper-loaded', 'true');\n            recordMetric(global, namespace, 'js_load_success', { source: attempt.key });\n            resolve(script);\n        };\n\n        script.onerror = () => {\n            cleanup();\n            script.setAttribute('data-mga-swiper-failed', 'true');\n            recordMetric(global, namespace, 'js_load_error', { source: attempt.key });\n            reject(new Error('Script load error'));\n        };\n\n        timeoutId = global.setTimeout(() => {\n            cleanup();\n            script.setAttribute('data-mga-swiper-failed', 'true');\n            recordMetric(global, namespace, 'js_load_timeout', { source: attempt.key, timeout: attempt.timeout });\n            reject(new Error('Script load timeout'));\n        }, attempt.timeout || DEFAULT_TIMEOUT);\n\n        doc.head.appendChild(script);\n        recordMetric(global, namespace, 'js_load_start', { source: attempt.key, src: attempt.js.src });\n    });\n};\n\nconst getLoaderState = (global) => {\n    if (!global) {\n        return { promise: null };\n    }\n\n    if (!global.mgaSwiperLoaderState || typeof global.mgaSwiperLoaderState !== 'object') {\n        global.mgaSwiperLoaderState = { promise: null };\n    }\n\n    return global.mgaSwiperLoaderState;\n};\n\nconst attemptLoad = (global, attempt, namespace) => {\n    if (!attempt || !attempt.inject) {\n        return Promise.resolve();\n    }\n\n    if (typeof global.Swiper === 'function') {\n        return Promise.resolve(global.Swiper);\n    }\n\n    recordMetric(global, namespace, 'attempt_start', { source: attempt.key });\n\n    return loadStylesheet(global, attempt, namespace)\n        .catch(() => null)\n        .then(() => loadScript(global, attempt, namespace))\n        .then(() => {\n            if (typeof global.Swiper === 'function') {\n                recordMetric(global, namespace, 'attempt_success', { source: attempt.key });\n                return global.Swiper;\n            }\n\n            recordMetric(global, namespace, 'attempt_no_global', { source: attempt.key });\n            throw new Error('Swiper global missing after load');\n        })\n        .catch((error) => {\n            recordMetric(global, namespace, 'attempt_error', {\n                source: attempt.key,\n                message: error && error.message ? error.message : String(error),\n            });\n            throw error;\n        });\n};\n\nconst runAttemptsSequentially = (global, attempts, namespace) => {\n    return attempts.reduce((promise, attempt) => {\n        return promise.catch(() => attemptLoad(global, attempt, namespace));\n    }, Promise.reject(new Error('initial')));\n};\n\nconst getConfig = (global, explicitConfig) => {\n    if (explicitConfig && typeof explicitConfig === 'object') {\n        return explicitConfig;\n    }\n\n    if (global && global.mgaSwiperLoaderConfig && typeof global.mgaSwiperLoaderConfig === 'object') {\n        return global.mgaSwiperLoaderConfig;\n    }\n\n    if (global && global.mgaAdminConfig && typeof global.mgaAdminConfig === 'object' && global.mgaAdminConfig.swiper) {\n        return global.mgaAdminConfig.swiper;\n    }\n\n    return null;\n};\n\nexport const ensureSwiper = (global = window, options = {}) => {\n    const namespace = typeof options.namespace === 'string' && options.namespace\n        ? options.namespace\n        : 'default';\n\n    if (!global) {\n        return Promise.reject(new Error('Global scope unavailable'));\n    }\n\n    if (typeof global.Swiper === 'function') {\n        recordMetric(global, namespace, 'already_available', {});\n        return Promise.resolve(global.Swiper);\n    }\n\n    const config = getConfig(global, options.config);\n    const attempts = normalizeAttempts(config);\n\n    if (!attempts.length) {\n        recordMetric(global, namespace, 'no_attempts_configured', {});\n        return Promise.reject(new Error('No Swiper attempts configured'));\n    }\n\n    const state = getLoaderState(global);\n\n    if (state.promise) {\n        return state.promise;\n    }\n\n    recordMetric(global, namespace, 'bootstrap', {\n        version: config && config.version ? config.version : null,\n        attempts: attempts.map((attempt) => attempt.key),\n    });\n\n    state.promise = runAttemptsSequentially(global, attempts, namespace)\n        .catch(() => {\n            if (typeof global.Swiper === 'function') {\n                return global.Swiper;\n            }\n\n            recordMetric(global, namespace, 'fatal', {});\n            throw new Error('Swiper could not be loaded');\n        })\n        .then(() => {\n            if (typeof global.Swiper === 'function') {\n                recordMetric(global, namespace, 'ready', {});\n                return global.Swiper;\n            }\n\n            recordMetric(global, namespace, 'fatal', {});\n            throw new Error('Swiper global unavailable');\n        })\n        .finally(() => {\n            state.promise = null;\n        });\n\n    return state.promise;\n};\n\nexport const getSwiperLoaderConfig = (global = window) => getConfig(global, null);\n\n", "export * from './sprintf';\nexport * from './icons';\nexport * from './focus';\nexport * from './swiper';\n", "import {\n    createSprintf,\n    createTranslate,\n    createIconSvg,\n    ensureSwiper,\n    getSharedI18n,\n    sanitizeIconKey,\n} from './shared';\n\n(function() {\n    \"use strict\";\n\n    const mgaI18n = getSharedI18n();\n    const mga__ = createTranslate(mgaI18n);\n    const mgaSprintf = createSprintf(mgaI18n);\n\n    const scheduleFrame = typeof window.requestAnimationFrame === 'function'\n        ? window.requestAnimationFrame.bind(window)\n        : (callback) => window.setTimeout(callback, 0);\n    const cancelFrame = typeof window.cancelAnimationFrame === 'function'\n        ? window.cancelAnimationFrame.bind(window)\n        : (id) => {\n            if (typeof window.clearTimeout === 'function') {\n                window.clearTimeout(id);\n            }\n        };\n\n    const buildLabelFromKey = (key) => {\n        if (typeof key !== 'string' || key.trim() === '') {\n            return '';\n        }\n\n        return key\n            .trim()\n            .split(/[-_\\s]+/)\n            .filter(Boolean)\n            .map((chunk) => chunk.charAt(0).toUpperCase() + chunk.slice(1))\n            .join(' ');\n    };\n\n    const createShareIconElement = (iconKey) => {\n        const wrapper = document.createElement('span');\n        wrapper.className = 'mga-share-option__icon';\n\n        const svg = createIconSvg(document, sanitizeIconKey(iconKey));\n\n        if (svg) {\n            wrapper.appendChild(svg);\n        }\n\n        return wrapper;\n    };\n\n    function normalizeShareChannels(rawChannels) {\n        const entries = [];\n\n        if (Array.isArray(rawChannels)) {\n            rawChannels.forEach((channel) => {\n                entries.push(channel);\n            });\n        } else if (rawChannels && typeof rawChannels === 'object') {\n            Object.keys(rawChannels).forEach((key) => {\n                const candidate = rawChannels[key];\n\n                if (candidate && typeof candidate === 'object') {\n                    entries.push(Object.assign({ key }, candidate));\n                }\n            });\n        }\n\n        const seenKeys = new Set();\n\n        return entries.reduce((accumulator, entry) => {\n            if (!entry || typeof entry !== 'object') {\n                return accumulator;\n            }\n\n            let rawKey = '';\n\n            if (typeof entry.key === 'string') {\n                rawKey = entry.key;\n            } else if (typeof entry.slug === 'string') {\n                rawKey = entry.slug;\n            }\n\n            let key = sanitizeIconKey(rawKey);\n\n            if (!key && typeof entry.label === 'string') {\n                key = sanitizeIconKey(entry.label.replace(/\\s+/g, '-'));\n            }\n\n            if (!key || seenKeys.has(key)) {\n                return accumulator;\n            }\n\n            seenKeys.add(key);\n\n            const label = typeof entry.label === 'string' && entry.label.trim()\n                ? entry.label.trim()\n                : buildLabelFromKey(key);\n\n            const template = typeof entry.template === 'string'\n                ? entry.template.trim()\n                : '';\n\n            const icon = sanitizeIconKey(entry.icon || key) || key;\n\n            const enabled = entry.enabled === true\n                || entry.enabled === '1'\n                || entry.enabled === 1\n                || entry.enabled === 'true'\n                || entry.enabled === 'on';\n\n            accumulator.push({\n                key,\n                label,\n                template,\n                icon,\n                enabled,\n            });\n\n            return accumulator;\n        }, []);\n    }\n\n    const DEFAULT_EFFECT = 'slide';\n    const DEFAULT_SPEED = 600;\n    const DEFAULT_EASING = 'ease-out';\n    const ALLOWED_EFFECTS = [ 'slide', 'fade', 'cube', 'coverflow', 'flip' ];\n    const HEAVY_EFFECTS = new Set( [ 'cube', 'coverflow', 'flip' ] );\n    const ALLOWED_EASINGS = [ 'ease', 'ease-in', 'ease-out', 'ease-in-out', 'linear' ];\n    const DEFAULT_THUMBS_LAYOUT = 'bottom';\n    const ALLOWED_THUMBS_LAYOUTS = [ 'bottom', 'left', 'hidden' ];\n\n    const sanitizeEffect = ( rawEffect ) => {\n        if ( typeof rawEffect !== 'string' ) {\n            return DEFAULT_EFFECT;\n        }\n\n        const normalized = rawEffect.trim().toLowerCase();\n        return ALLOWED_EFFECTS.includes( normalized ) ? normalized : DEFAULT_EFFECT;\n    };\n\n    const sanitizeSpeed = ( rawSpeed ) => {\n        const parsed = parseInt( rawSpeed, 10 );\n\n        if ( Number.isNaN( parsed ) ) {\n            return DEFAULT_SPEED;\n        }\n\n        return Math.min( Math.max( parsed, 100 ), 5000 );\n    };\n\n    const sanitizeEasing = ( rawEasing ) => {\n        if ( typeof rawEasing !== 'string' ) {\n            return DEFAULT_EASING;\n        }\n\n        const normalized = rawEasing.trim().toLowerCase();\n        return ALLOWED_EASINGS.includes( normalized ) ? normalized : DEFAULT_EASING;\n    };\n\n    const sanitizeThumbsLayout = ( rawLayout ) => {\n        if ( typeof rawLayout !== 'string' ) {\n            return DEFAULT_THUMBS_LAYOUT;\n        }\n\n        const normalized = rawLayout.trim().toLowerCase();\n        return ALLOWED_THUMBS_LAYOUTS.includes( normalized ) ? normalized : DEFAULT_THUMBS_LAYOUT;\n    };\n\n    const applyTransitionEasing = ( swiperInstance, easing ) => {\n        if ( ! swiperInstance || ! swiperInstance.wrapperEl ) {\n            return;\n        }\n\n        swiperInstance.wrapperEl.style.transitionTimingFunction = easing;\n    };\n\n    function updateEchoBackground(viewer, imageUrl) {\n        if (!viewer) {\n            return;\n        }\n\n        const bgContainer = viewer.querySelector('.mga-echo-bg');\n        if (!bgContainer) return;\n\n        const sanitizedUrl = typeof imageUrl === 'string' ? imageUrl.trim() : '';\n\n        if (!sanitizedUrl) {\n            const oldImg = bgContainer.querySelector('.mga-visible');\n            if (oldImg) {\n                oldImg.classList.remove('mga-visible');\n                setTimeout(() => { if (oldImg.parentElement) { oldImg.parentElement.removeChild(oldImg); } }, 400);\n            }\n            viewer.classList.remove('mga-has-texture');\n            return;\n        }\n\n        const newImg = document.createElement('img');\n        newImg.className = 'mga-echo-bg__image';\n        newImg.alt = '';\n        newImg.setAttribute('aria-hidden', 'true');\n        newImg.setAttribute('role', 'presentation');\n        newImg.decoding = 'async';\n        let hasLoaded = false;\n\n        const handleLoad = () => {\n            if (hasLoaded) {\n                return;\n            }\n            hasLoaded = true;\n            const oldImg = bgContainer.querySelector('.mga-visible');\n            if (oldImg) {\n                oldImg.classList.remove('mga-visible');\n                setTimeout(() => { if (oldImg.parentElement) { oldImg.parentElement.removeChild(oldImg); } }, 400);\n            }\n            bgContainer.appendChild(newImg);\n            setTimeout(() => newImg.classList.add('mga-visible'), 10);\n            viewer.classList.remove('mga-has-texture');\n        };\n\n        newImg.onload = handleLoad;\n        newImg.onerror = () => {\n            viewer.classList.remove('mga-has-texture');\n        };\n        newImg.src = sanitizedUrl;\n\n        if (newImg.complete) {\n            setTimeout(() => handleLoad());\n        }\n    }\n\n    let swiperModulesRegistered = false;\n\n    const registerSwiperModules = () => {\n        if (swiperModulesRegistered) {\n            return;\n        }\n\n        if (typeof Swiper !== 'function') {\n            return;\n        }\n\n        if (typeof Swiper.use !== 'function') {\n            swiperModulesRegistered = true;\n            return;\n        }\n\n        const moduleKeys = [\n            'Navigation',\n            'Autoplay',\n            'Thumbs',\n            'Zoom',\n            'Keyboard',\n            'A11y',\n            'EffectFade',\n            'EffectCube',\n            'EffectCoverflow',\n            'EffectFlip',\n        ];\n\n        const modules = moduleKeys.reduce((registered, key) => {\n            if (Swiper[key]) {\n                registered.push(Swiper[key]);\n            }\n\n            return registered;\n        }, []);\n\n        if (modules.length) {\n            Swiper.use(modules);\n        }\n\n        swiperModulesRegistered = true;\n    };\n\n    function updateAutoplayButtonState(viewer, isRunning) {\n        if (!viewer) {\n            return;\n        }\n\n        const playPauseButton = viewer.querySelector('#mga-play-pause');\n        if (!playPauseButton) {\n            return;\n        }\n\n        playPauseButton.setAttribute('aria-pressed', isRunning ? 'true' : 'false');\n        const actionLabel = isRunning\n            ? mga__( 'Mettre le diaporama en pause', 'lightbox-jlg' )\n            : mga__( 'Lancer le diaporama', 'lightbox-jlg' );\n        playPauseButton.setAttribute('aria-label', actionLabel);\n        playPauseButton.setAttribute('title', actionLabel);\n    }\n\n    function initGalleryViewer() {\n        const settings = window.mga_settings || {};\n        const thumbsLayout = sanitizeThumbsLayout(settings.thumbs_layout);\n        const noop = () => {};\n        const normalizeFlag = (value, defaultValue = true) => {\n            if (typeof value === 'undefined') {\n                return defaultValue;\n            }\n\n            if (typeof value === 'string') {\n                const normalized = value.trim().toLowerCase();\n\n                if (['false', '0', 'no', 'off'].includes(normalized)) {\n                    return false;\n                }\n\n                if (['true', '1', 'yes', 'on'].includes(normalized)) {\n                    return true;\n                }\n            }\n\n            if (typeof value === 'number') {\n                return value !== 0;\n            }\n\n            return Boolean(value);\n        };\n\n        const includeSvg = normalizeFlag(settings.include_svg, true);\n        const baseImagePattern = 'jpe?g|png|gif|bmp|webp|avif';\n        const imagePatternSource = includeSvg ? `${baseImagePattern}|svg` : baseImagePattern;\n        const IMAGE_FILE_PATTERN = new RegExp(`\\.(${imagePatternSource})(?:\\\\?.*)?(?:#.*)?$`, 'i');\n        const isSvgLikeUrl = (url) => typeof url === 'string' && /\\.svg(?:\\?.*)?(?:#.*)?$/i.test(url);\n        const debug = window.mgaDebug || {\n            enabled: false,\n            init: noop,\n            log: noop,\n            updateInfo: noop,\n            updateVisibleSlides: noop,\n            onForceOpen: noop,\n            stopTimer: noop,\n            restartTimer: noop,\n            table: noop,\n            shareAction: noop,\n        };\n        const showZoom = normalizeFlag(settings.show_zoom, true);\n        const showDownload = normalizeFlag(settings.show_download, true);\n        let showShare = normalizeFlag(settings.show_share, true);\n        const showFullscreen = normalizeFlag(settings.show_fullscreen, true);\n        const showThumbsMobile = normalizeFlag(settings.show_thumbs_mobile, true);\n        let showCtas = normalizeFlag(settings.show_cta, true);\n        const closeOnBackdropClick = normalizeFlag(settings.close_on_backdrop, true);\n        const loopEnabled = normalizeFlag(settings.loop, true);\n        const startOnClickedImageSetting =\n            Object.prototype.hasOwnProperty.call(settings, 'start_on_clicked_image')\n                ? settings.start_on_clicked_image\n                : settings.startOnClickedImage;\n        const startOnClickedImage = normalizeFlag(startOnClickedImageSetting, false);\n        let shareCopyEnabled = normalizeFlag(settings.share_copy, true);\n        let shareDownloadEnabled = normalizeFlag(settings.share_download, true);\n        let shareChannels = normalizeShareChannels(settings.share_channels);\n        const shareActionLabels = {\n            copy: mga__( 'Copier le lien', 'lightbox-jlg' ),\n            download: mga__( 'T\u00E9l\u00E9chargement rapide', 'lightbox-jlg' ),\n            native: mga__( \"Partager via l'appareil\", 'lightbox-jlg' ),\n        };\n        const resolveShareOptionsSnapshot = () => {\n            const options = [];\n\n            shareChannels.forEach((channel) => {\n                if (!channel || typeof channel !== 'object') {\n                    return;\n                }\n\n                const { enabled, template } = channel;\n                const hasTemplate = typeof template === 'string' && template.trim() !== '';\n\n                if (!enabled || !hasTemplate) {\n                    return;\n                }\n\n                options.push({\n                    type: 'social',\n                    key: channel.key,\n                    label: channel.label || buildLabelFromKey(channel.key) || channel.key,\n                    template: template.trim(),\n                    icon: channel.icon || channel.key,\n                });\n            });\n\n            if (shareCopyEnabled) {\n                options.push({\n                    type: 'copy',\n                    key: 'copy',\n                    label: shareActionLabels.copy,\n                    icon: 'copy',\n                });\n            }\n\n            if (shareDownloadEnabled) {\n                options.push({\n                    type: 'download',\n                    key: 'download',\n                    label: shareActionLabels.download,\n                    icon: 'download',\n                });\n            }\n\n            if (hasNativeShareSupport()) {\n                options.push({\n                    type: 'native',\n                    key: 'native',\n                    label: shareActionLabels.native,\n                    icon: 'native',\n                });\n            }\n\n            return options;\n        };\n        const hasAnyShareActionAvailable = () => resolveShareOptionsSnapshot().length > 0;\n        const shouldDisplayShareButton = () => showShare && hasAnyShareActionAvailable();\n        const optionalToolbarHandlers = [];\n        const SCROLL_LOCK_CLASS = 'mga-scroll-locked';\n        let mainSwiper = null;\n        let thumbsSwiper = null;\n        let cleanupAutoplayPreferenceListener = null;\n        let autoplayWasRunningBeforePreferenceChange = false;\n        const preloadedUrls = new Set();\n        const pendingHeaderOffsetUpdates = new WeakMap();\n        let resizeTimeout;\n        let isResizeListenerAttached = false;\n        let initialBodyOverflow = null;\n        let initialBodyPaddingRight = null;\n        let bodyOverflowWasModified = false;\n        let bodyPaddingRightWasModified = false;\n        let bodyScrollLockClassAdded = false;\n        let lastFocusedElementBeforeViewer = null;\n        let viewerFocusTrapHandler = null;\n        let currentGalleryImages = [];\n        let currentGalleryId = null;\n        let shareModal = null;\n        let shareModalIsOpen = false;\n        let shareModalInvoker = null;\n        let shareModalKeydownHandler = null;\n        let thumbAccessibilityUpdater = null;\n        let captionFeedbackHideTimeout = null;\n        const captionAnnouncementState = {\n            lastBaseAnnouncement: '',\n            isTemporaryMessageActive: false,\n        };\n\n        debug.init();\n\n        const shareToolbarHandlerConfig = {\n            selector: '#mga-share',\n            handler: (event) => {\n                event.preventDefault();\n                const activeData = getActiveImageData();\n                if (!activeData || !activeData.image) {\n                    debug.log(mga__( \"Impossible de partager l\u2019image active.\", 'lightbox-jlg' ), true);\n                    return true;\n                }\n\n                const shared = openSharePanel(activeData.image);\n                if (!shared) {\n                    debug.log(mga__( \"Aucune option de partage disponible pour l\u2019image active.\", 'lightbox-jlg' ), true);\n                }\n\n                return true;\n            },\n        };\n\n        const registerShareToolbarHandler = () => {\n            if (!optionalToolbarHandlers.includes(shareToolbarHandlerConfig)) {\n                optionalToolbarHandlers.push(shareToolbarHandlerConfig);\n                updateToolbarOptionalButtons();\n            }\n        };\n\n        const unregisterShareToolbarHandler = () => {\n            const index = optionalToolbarHandlers.indexOf(shareToolbarHandlerConfig);\n            if (index !== -1) {\n                optionalToolbarHandlers.splice(index, 1);\n                updateToolbarOptionalButtons();\n            }\n        };\n\n        if (showZoom) {\n            optionalToolbarHandlers.push({\n                selector: '#mga-zoom',\n                handler: () => {\n                    if (mainSwiper && mainSwiper.zoom) {\n                        mainSwiper.zoom.toggle();\n                        return true;\n                    }\n\n                    return false;\n                },\n            });\n        }\n\n        if (showDownload) {\n            optionalToolbarHandlers.push({\n                selector: '#mga-download',\n                handler: (event) => {\n                    event.preventDefault();\n                    const highResUrl = getActiveHighResUrl();\n                    if (highResUrl) {\n                        const didDownload = triggerImageDownload(highResUrl);\n                        if (!didDownload) {\n                            debug.log(mga__( \"Impossible de lancer le t\u00E9l\u00E9chargement de l\u2019image active.\", 'lightbox-jlg' ), true);\n                        }\n                    } else {\n                        debug.log(mga__( \"URL haute r\u00E9solution introuvable pour l\u2019image active.\", 'lightbox-jlg' ), true);\n                    }\n\n                    return true;\n                },\n            });\n        }\n\n        if (shouldDisplayShareButton()) {\n            registerShareToolbarHandler();\n        }\n\n        if (showFullscreen) {\n            optionalToolbarHandlers.push({\n                selector: '#mga-fullscreen',\n                handler: (event, viewer) => {\n                    if (!viewer) {\n                        return false;\n                    }\n\n                    const { request: requestFullscreen, exit: exitFullscreen, element: fullscreenElement } = resolveFullscreenApi(viewer);\n\n                    if (!fullscreenElement) {\n                        if (requestFullscreen) {\n                            try {\n                                const result = requestFullscreen();\n                                if (result && typeof result.catch === 'function') {\n                                    result.catch(err => debug.log(mgaSprintf(mga__( 'Erreur plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true));\n                                }\n                            } catch (err) {\n                                debug.log(mgaSprintf(mga__( 'Erreur plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true);\n                            }\n                        } else {\n                            debug.log(mga__( 'API plein \u00E9cran indisponible sur ce navigateur.', 'lightbox-jlg' ), true);\n                        }\n                    } else if (exitFullscreen) {\n                        try {\n                            const result = exitFullscreen();\n                            if (result && typeof result.catch === 'function') {\n                                result.catch(err => debug.log(mgaSprintf(mga__( 'Erreur de sortie du plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true));\n                            }\n                        } catch (err) {\n                            debug.log(mgaSprintf(mga__( 'Erreur de sortie du plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true);\n                        }\n                    } else {\n                        debug.log(mga__( 'API de fermeture du plein \u00E9cran indisponible sur ce navigateur.', 'lightbox-jlg' ), true);\n                    }\n\n                    return true;\n                },\n            });\n        }\n\n        function resolveEventTarget(event) {\n            if (!event || !event.target) {\n                return null;\n            }\n\n            const target = event.target;\n\n            if (target instanceof Element) {\n                return target;\n            }\n\n            if (target && typeof target === 'object') {\n                if (target.parentElement instanceof Element) {\n                    return target.parentElement;\n                }\n\n                if (target.parentNode instanceof Element) {\n                    return target.parentNode;\n                }\n            }\n\n            return null;\n        }\n\n        function getActiveImageData() {\n            if (!Array.isArray(currentGalleryImages) || !currentGalleryImages.length) {\n                return null;\n            }\n\n            const fallbackIndex = mainSwiper && typeof mainSwiper.activeIndex === 'number'\n                ? mainSwiper.activeIndex\n                : 0;\n            const activeIndex = mainSwiper && typeof mainSwiper.realIndex === 'number'\n                ? mainSwiper.realIndex\n                : fallbackIndex;\n\n            const activeImage = currentGalleryImages[activeIndex];\n\n            if (!activeImage) {\n                return null;\n            }\n\n            return { image: activeImage, index: activeIndex };\n        }\n\n        function getActiveHighResUrl() {\n            const activeData = getActiveImageData();\n            if (!activeData) {\n                return null;\n            }\n\n            const { image } = activeData;\n\n            if (image && typeof image.highResUrl === 'string' && image.highResUrl) {\n                return image.highResUrl;\n            }\n\n            return null;\n        }\n\n        function triggerImageDownload(imageUrl) {\n            if (typeof imageUrl !== 'string' || !imageUrl) {\n                return false;\n            }\n\n            if (!document.body || typeof document.body.appendChild !== 'function') {\n                debug.log(mga__( 'T\u00E9l\u00E9chargement impossible\u00A0: document.body indisponible.', 'lightbox-jlg' ), true);\n                return false;\n            }\n\n            let link = null;\n\n            try {\n                link = document.createElement('a');\n                link.href = imageUrl;\n                link.rel = 'noopener noreferrer';\n\n                let fallbackName = 'image';\n\n                try {\n                    const resolvedUrl = new URL(imageUrl, window.location.href);\n                    const pathname = resolvedUrl && typeof resolvedUrl.pathname === 'string'\n                        ? resolvedUrl.pathname\n                        : '';\n\n                    if (pathname) {\n                        const segments = pathname.split('/').filter(Boolean);\n                        const lastSegment = segments.pop();\n\n                        if (lastSegment) {\n                            fallbackName = lastSegment;\n                        }\n                    }\n                } catch (innerError) {\n                    // Intentionally swallow URL parsing errors; fallbackName remains 'image'.\n                }\n\n                link.download = fallbackName;\n\n                document.body.appendChild(link);\n                link.click();\n                return true;\n            } catch (error) {\n                debug.log(mgaSprintf(mga__( \"\u00C9chec du t\u00E9l\u00E9chargement\u00A0: %s\", 'lightbox-jlg' ), error.message), true);\n                return false;\n            } finally {\n                if (link && link.parentNode === document.body) {\n                    document.body.removeChild(link);\n                }\n            }\n        }\n\n        function updateToolbarOptionalButtons(toolbarElement) {\n            const providedToolbar = toolbarElement || null;\n            let toolbar = providedToolbar;\n\n            if (!toolbar) {\n                const viewer = document.getElementById('mga-viewer');\n                if (viewer) {\n                    toolbar = viewer.querySelector('.mga-toolbar');\n                }\n            }\n\n            if (!toolbar) {\n                return;\n            }\n\n            toolbar.setAttribute('data-mga-optional-buttons', String(optionalToolbarHandlers.length));\n        }\n\n        function createShareToolbarButton() {\n            const shareButton = document.createElement('button');\n            shareButton.type = 'button';\n            shareButton.id = 'mga-share';\n            shareButton.className = 'mga-toolbar-button';\n            shareButton.setAttribute('aria-label', mga__( 'Partager l\u2019image', 'lightbox-jlg' ));\n            shareButton.setAttribute('aria-haspopup', 'dialog');\n            shareButton.setAttribute('aria-expanded', 'false');\n            shareButton.setAttribute('aria-controls', 'mga-share-modal');\n\n            const shareIcon = createSvgElement('svg', {\n                class: 'mga-icon mga-share-icon',\n                viewBox: '0 0 24 24',\n                fill: 'currentColor',\n            });\n            const sharePath = createSvgElement('path', {\n                d: 'M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.02-4.11A2.99 2.99 0 0 0 18 7.91c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.03.47.09.7L8.07 9.7A2.99 2.99 0 0 0 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.03-.82l7.05 4.12c-.06.23-.08.46-.08.7 0 1.65 1.34 2.99 3 2.99s3-1.34 3-2.99-1.34-3-3-3z',\n            });\n            shareIcon.appendChild(sharePath);\n            shareButton.appendChild(shareIcon);\n\n            return shareButton;\n        }\n\n        function hasNativeShareSupport() {\n            return typeof navigator !== 'undefined' && navigator && typeof navigator.share === 'function';\n        }\n\n        function ensureShareModal(viewer) {\n            if (!showShare || !hasAnyShareActionAvailable()) {\n                return null;\n            }\n\n            if (shareModal && shareModal.container && shareModal.container.parentElement === viewer) {\n                return shareModal;\n            }\n\n            const modalContainer = document.createElement('div');\n            modalContainer.id = 'mga-share-modal';\n            modalContainer.className = 'mga-share-modal';\n            modalContainer.setAttribute('role', 'dialog');\n            modalContainer.setAttribute('aria-modal', 'true');\n            modalContainer.setAttribute('aria-hidden', 'true');\n            modalContainer.setAttribute('hidden', 'hidden');\n\n            const overlay = document.createElement('div');\n            overlay.className = 'mga-share-modal__overlay';\n            overlay.setAttribute('aria-hidden', 'true');\n            modalContainer.appendChild(overlay);\n\n            const dialog = document.createElement('div');\n            dialog.className = 'mga-share-modal__dialog';\n            dialog.setAttribute('role', 'document');\n            dialog.setAttribute('tabindex', '-1');\n            modalContainer.appendChild(dialog);\n\n            const header = document.createElement('div');\n            header.className = 'mga-share-modal__header';\n            dialog.appendChild(header);\n\n            const title = document.createElement('h2');\n            title.id = 'mga-share-title';\n            title.className = 'mga-share-modal__title';\n            title.textContent = mga__( 'Partager cette image', 'lightbox-jlg' );\n            header.appendChild(title);\n\n            const closeButton = document.createElement('button');\n            closeButton.type = 'button';\n            closeButton.className = 'mga-share-modal__close';\n            closeButton.setAttribute('aria-label', mga__( 'Fermer la fen\u00EAtre de partage', 'lightbox-jlg' ));\n            closeButton.innerHTML = '&times;';\n            header.appendChild(closeButton);\n\n            const body = document.createElement('div');\n            body.className = 'mga-share-modal__body';\n            dialog.appendChild(body);\n\n            const description = document.createElement('p');\n            description.id = 'mga-share-description';\n            description.className = 'mga-share-modal__description';\n            description.textContent = mga__( 'Choisissez une option de partage\u00A0:', 'lightbox-jlg' );\n            body.appendChild(description);\n\n            modalContainer.setAttribute('aria-labelledby', title.id);\n            modalContainer.setAttribute('aria-describedby', description.id);\n\n            const list = document.createElement('ul');\n            list.className = 'mga-share-modal__list';\n            list.setAttribute('data-mga-share-list', 'true');\n            body.appendChild(list);\n\n            const feedback = document.createElement('p');\n            feedback.className = 'mga-share-modal__feedback';\n            feedback.setAttribute('role', 'status');\n            feedback.setAttribute('aria-live', 'polite');\n            feedback.setAttribute('aria-atomic', 'true');\n            feedback.setAttribute('hidden', 'hidden');\n            body.appendChild(feedback);\n\n            viewer.appendChild(modalContainer);\n\n            const onOverlayClick = (event) => {\n                if (event && typeof event.stopPropagation === 'function') {\n                    event.stopPropagation();\n                }\n\n                closeShareModal({ reason: 'overlay' });\n            };\n            const onCloseClick = () => closeShareModal({ reason: 'close-button' });\n\n            overlay.addEventListener('click', onOverlayClick);\n            closeButton.addEventListener('click', onCloseClick);\n            list.addEventListener('click', onShareModalListClick);\n\n            shareModal = {\n                container: modalContainer,\n                dialog,\n                list,\n                closeButton,\n                overlay,\n                feedback,\n                description,\n                payload: null,\n                options: [],\n            };\n\n            return shareModal;\n        }\n\n        function resetShareModalFeedback() {\n            if (!shareModal || !shareModal.feedback) {\n                return;\n            }\n\n            shareModal.feedback.textContent = '';\n            shareModal.feedback.removeAttribute('data-mga-state');\n            shareModal.feedback.setAttribute('hidden', 'hidden');\n        }\n\n        function setShareModalFeedback(message, isError = false, tone) {\n            if (!shareModal || !shareModal.feedback) {\n                return;\n            }\n\n            shareModal.feedback.textContent = message || '';\n\n            const resolvedTone = tone || (isError ? 'error' : (message ? 'info' : ''));\n\n            if (message) {\n                shareModal.feedback.removeAttribute('hidden');\n            } else {\n                shareModal.feedback.setAttribute('hidden', 'hidden');\n            }\n\n            if (resolvedTone) {\n                shareModal.feedback.setAttribute('data-mga-state', resolvedTone);\n            } else {\n                shareModal.feedback.removeAttribute('data-mga-state');\n            }\n\n            if (message) {\n                announceViewerFeedback(message, {\n                    tone: resolvedTone || (isError ? 'error' : 'info'),\n                });\n            }\n        }\n\n        function populateShareModal(modalInstance, options, sharePayload) {\n            if (!modalInstance || !modalInstance.list) {\n                return;\n            }\n\n            resetShareModalFeedback();\n\n            while (modalInstance.list.firstChild) {\n                modalInstance.list.removeChild(modalInstance.list.firstChild);\n            }\n\n            modalInstance.options = Array.isArray(options) ? options : [];\n            modalInstance.payload = sharePayload || {};\n\n            modalInstance.list.setAttribute('data-mga-share-count', String(modalInstance.options.length));\n\n            modalInstance.options.forEach((option) => {\n                const item = document.createElement('li');\n                item.className = 'mga-share-modal__item';\n\n                const button = document.createElement('button');\n                button.type = 'button';\n                button.className = 'mga-share-option';\n                button.setAttribute('data-share-type', option.type);\n                button.setAttribute('data-share-key', option.key);\n                button.setAttribute('data-share-label', option.label);\n\n                if (option.template) {\n                    button.setAttribute('data-share-template', option.template);\n                }\n\n                if (option.icon) {\n                    button.setAttribute('data-share-icon', option.icon);\n                }\n\n                const content = document.createElement('span');\n                content.className = 'mga-share-option__content';\n\n                const iconElement = createShareIconElement(option.icon);\n\n                if (iconElement) {\n                    content.appendChild(iconElement);\n                }\n\n                const labelSpan = document.createElement('span');\n                labelSpan.className = 'mga-share-option__label';\n                labelSpan.textContent = option.label;\n                content.appendChild(labelSpan);\n\n                button.appendChild(content);\n\n                const chevron = document.createElement('span');\n                chevron.className = 'mga-share-option__chevron';\n                chevron.setAttribute('aria-hidden', 'true');\n                chevron.textContent = '\u203A';\n                button.appendChild(chevron);\n\n                item.appendChild(button);\n                modalInstance.list.appendChild(item);\n            });\n        }\n\n        function buildShareOptions(sharePayload) {\n            void sharePayload;\n\n            return resolveShareOptionsSnapshot().map((option) => ({ ...option }));\n        }\n\n        function getShareModalFocusableElements(modalInstance) {\n            if (!modalInstance || !modalInstance.dialog) {\n                return [];\n            }\n\n            const focusableSelectors = [\n                'a[href]',\n                'button:not([disabled])',\n                'textarea:not([disabled])',\n                'input:not([disabled])',\n                'select:not([disabled])',\n                '[tabindex]:not([tabindex=\"-1\"])',\n            ];\n\n            return Array.from(\n                modalInstance.dialog.querySelectorAll(focusableSelectors.join(','))\n            ).filter((element) => !element.hasAttribute('disabled'));\n        }\n\n        function onShareModalKeydown(event) {\n            if (!shareModalIsOpen || !shareModal) {\n                return;\n            }\n\n            if (event.key === 'Escape') {\n                event.preventDefault();\n                closeShareModal({ reason: 'escape' });\n                return;\n            }\n\n            if (event.key !== 'Tab') {\n                return;\n            }\n\n            const focusable = getShareModalFocusableElements(shareModal);\n\n            if (!focusable.length) {\n                return;\n            }\n\n            const first = focusable[0];\n            const last = focusable[focusable.length - 1];\n            const activeElement = document.activeElement;\n\n            if (event.shiftKey) {\n                if (activeElement === first || !shareModal.dialog.contains(activeElement)) {\n                    event.preventDefault();\n                    last.focus();\n                }\n            } else if (activeElement === last) {\n                event.preventDefault();\n                first.focus();\n            }\n        }\n\n        function openShareModal(modalInstance, invokerButton) {\n            if (!modalInstance || !modalInstance.container) {\n                return false;\n            }\n\n            modalInstance.container.removeAttribute('hidden');\n            modalInstance.container.setAttribute('aria-hidden', 'false');\n            modalInstance.container.classList.add('is-visible');\n\n            shareModalIsOpen = true;\n            shareModalInvoker = invokerButton || (document.activeElement instanceof HTMLElement ? document.activeElement : null);\n            shareModalKeydownHandler = onShareModalKeydown;\n\n            document.addEventListener('keydown', shareModalKeydownHandler, true);\n\n            if (invokerButton) {\n                invokerButton.setAttribute('aria-expanded', 'true');\n            }\n\n            const focusable = getShareModalFocusableElements(modalInstance);\n\n            if (focusable.length) {\n                focusable[0].focus();\n            } else if (modalInstance.closeButton) {\n                modalInstance.closeButton.focus();\n            }\n\n            debug.shareAction('open', {\n                options: modalInstance.options.map((option) => option.key),\n            });\n\n            return true;\n        }\n\n        function closeShareModal({ restoreFocus = true, reason = 'manual' } = {}) {\n            if (!shareModal || !shareModal.container || !shareModalIsOpen) {\n                return;\n            }\n\n            shareModal.container.classList.remove('is-visible');\n            shareModal.container.setAttribute('aria-hidden', 'true');\n            shareModal.container.setAttribute('hidden', 'hidden');\n\n            if (shareModalKeydownHandler) {\n                document.removeEventListener('keydown', shareModalKeydownHandler, true);\n                shareModalKeydownHandler = null;\n            }\n\n            const shareButtonElement = document.getElementById('mga-share');\n\n            if (shareButtonElement) {\n                shareButtonElement.setAttribute('aria-expanded', 'false');\n            }\n\n            shareModalIsOpen = false;\n\n            if (restoreFocus && shareModalInvoker && typeof shareModalInvoker.focus === 'function') {\n                shareModalInvoker.focus();\n            }\n\n            shareModalInvoker = null;\n\n            debug.shareAction('close', { reason });\n        }\n\n        function buildShareUrl(template, sharePayload) {\n            if (typeof template !== 'string' || !template) {\n                return '';\n            }\n\n            const payload = sharePayload || {};\n            const replacements = {\n                url: payload.url || '',\n                text: payload.text || payload.title || '',\n                title: payload.title || payload.text || '',\n            };\n\n            return template.replace(/%([a-z]+)%/gi, (match, key) => {\n                const normalized = key.toLowerCase();\n\n                if (!Object.prototype.hasOwnProperty.call(replacements, normalized)) {\n                    return '';\n                }\n\n                return encodeURIComponent(replacements[normalized]);\n            });\n        }\n\n        function copyToClipboard(text) {\n            if (typeof text !== 'string') {\n                return Promise.reject(new Error('invalid-text'));\n            }\n\n            if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {\n                return navigator.clipboard.writeText(text);\n            }\n\n            return new Promise((resolve, reject) => {\n                try {\n                    const textarea = document.createElement('textarea');\n                    textarea.value = text;\n                    textarea.setAttribute('readonly', '');\n                    textarea.style.position = 'absolute';\n                    textarea.style.left = '-9999px';\n                    document.body.appendChild(textarea);\n                    textarea.select();\n                    const successful = document.execCommand('copy');\n                    document.body.removeChild(textarea);\n\n                    if (successful) {\n                        resolve();\n                    } else {\n                        reject(new Error('execCommand-failed'));\n                    }\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        }\n\n        function onShareModalListClick(event) {\n            if (!shareModal || !shareModal.list || !shareModalIsOpen) {\n                return;\n            }\n\n            const trigger = event.target instanceof Element\n                ? event.target.closest('button[data-share-type]')\n                : null;\n\n            if (!trigger) {\n                return;\n            }\n\n            event.preventDefault();\n\n            const shareType = trigger.getAttribute('data-share-type');\n            const shareKey = trigger.getAttribute('data-share-key') || '';\n            const shareLabel = trigger.getAttribute('data-share-label') || shareKey;\n            const payload = shareModal.payload || {};\n\n            if ('social' === shareType) {\n                const template = trigger.getAttribute('data-share-template') || '';\n                const shareUrl = buildShareUrl(template, payload);\n\n                if (!shareUrl) {\n                    setShareModalFeedback(mga__( 'Impossible de g\u00E9n\u00E9rer le lien de partage.', 'lightbox-jlg' ), true, 'error');\n                    debug.shareAction('social', { target: shareKey, success: false, reason: 'invalid-url' });\n                    return;\n                }\n\n                let popup = null;\n\n                if (typeof window !== 'undefined' && window && typeof window.open === 'function') {\n                    popup = window.open(shareUrl, '_blank', 'noopener,noreferrer');\n\n                    if (popup && typeof popup === 'object' && 'opener' in popup) {\n                        try {\n                            popup.opener = null;\n                        } catch (error) {\n                            // Some browsers might throw when attempting to modify opener on cross-origin windows.\n                            // Silently ignore as the security mitigation is best-effort.\n                            void error;\n                        }\n                    }\n                }\n\n                if (popup) {\n                    setShareModalFeedback(\n                        mgaSprintf(\n                            mga__( 'Ouverture de %s dans un nouvel onglet.', 'lightbox-jlg' ),\n                            shareLabel\n                        ),\n                        false,\n                        'info'\n                    );\n                    debug.shareAction('social', { target: shareKey, success: true, url: shareUrl });\n                } else {\n                    setShareModalFeedback(\n                        mgaSprintf(\n                            mga__( 'Impossible d\u2019ouvrir %s. V\u00E9rifiez votre bloqueur de fen\u00EAtres.', 'lightbox-jlg' ),\n                            shareLabel\n                        ),\n                        true,\n                        'error'\n                    );\n                    debug.shareAction('social', { target: shareKey, success: false, url: shareUrl });\n                }\n\n                return;\n            }\n\n            if ('copy' === shareType) {\n                if (!payload.url) {\n                    setShareModalFeedback(mga__( 'Aucun lien \u00E0 copier pour cette image.', 'lightbox-jlg' ), true, 'error');\n                    debug.shareAction('copy', { success: false, reason: 'missing-url' });\n                    return;\n                }\n\n                copyToClipboard(payload.url)\n                    .then(() => {\n                        setShareModalFeedback(mga__( 'Lien copi\u00E9 dans le presse-papiers.', 'lightbox-jlg' ), false, 'success');\n                        debug.shareAction('copy', { success: true });\n                    })\n                    .catch((error) => {\n                        setShareModalFeedback(mga__( 'Impossible de copier le lien. Essayez le raccourci clavier.', 'lightbox-jlg' ), true, 'error');\n                        debug.shareAction('copy', { success: false, reason: error && error.message ? error.message : 'copy-error' });\n                    });\n\n                return;\n            }\n\n            if ('download' === shareType) {\n                if (!payload.url) {\n                    setShareModalFeedback(mga__( 'Aucun fichier \u00E0 t\u00E9l\u00E9charger pour cette image.', 'lightbox-jlg' ), true, 'error');\n                    debug.shareAction('download', { success: false, reason: 'missing-url' });\n                    return;\n                }\n\n                const didDownload = triggerImageDownload(payload.url);\n\n                if (didDownload) {\n                    setShareModalFeedback(mga__( 'T\u00E9l\u00E9chargement de l\u2019image lanc\u00E9.', 'lightbox-jlg' ), false, 'success');\n                    debug.shareAction('download', { success: true });\n                } else {\n                    setShareModalFeedback(mga__( 'Impossible de lancer le t\u00E9l\u00E9chargement.', 'lightbox-jlg' ), true, 'error');\n                    debug.shareAction('download', { success: false });\n                }\n\n                return;\n            }\n\n            if ('native' === shareType) {\n                if (!hasNativeShareSupport()) {\n                    setShareModalFeedback(mga__( 'Le partage natif n\u2019est pas pris en charge sur ce navigateur.', 'lightbox-jlg' ), true, 'error');\n                    debug.shareAction('native', { success: false, reason: 'unsupported' });\n                    return;\n                }\n\n                try {\n                    const shareResult = navigator.share(payload);\n                    debug.shareAction('native', { success: true });\n                    closeShareModal({ restoreFocus: false, reason: 'native-share' });\n\n                    if (shareResult && typeof shareResult.catch === 'function') {\n                        shareResult.catch((error) => {\n                            const message = error && error.message\n                                ? error.message\n                                : mga__( 'Partage annul\u00E9.', 'lightbox-jlg' );\n                            debug.shareAction('native', { success: false, reason: message });\n                        });\n                    }\n                } catch (error) {\n                    setShareModalFeedback(\n                        mgaSprintf(\n                            mga__( 'Partage natif impossible\u00A0: %s', 'lightbox-jlg' ),\n                            error && error.message ? error.message : 'unknown'\n                        ),\n                        true,\n                        'error'\n                    );\n                    debug.shareAction('native', { success: false, reason: error && error.message ? error.message : 'error' });\n                }\n\n                return;\n            }\n\n            debug.shareAction('unknown', { type: shareType });\n        }\n\n        function openSharePanel(imageData) {\n            if (!imageData || typeof imageData.highResUrl !== 'string' || !imageData.highResUrl) {\n                return false;\n            }\n\n            const viewer = document.getElementById('mga-viewer');\n            if (!viewer) {\n                return false;\n            }\n\n            const modalInstance = ensureShareModal(viewer);\n            if (!modalInstance) {\n                return false;\n            }\n\n            const caption = typeof imageData.caption === 'string' ? imageData.caption.trim() : '';\n            const documentTitle = typeof document !== 'undefined' && document && typeof document.title === 'string'\n                ? document.title\n                : '';\n\n            const sharePayload = { url: imageData.highResUrl };\n\n            if (caption) {\n                sharePayload.text = caption;\n            }\n\n            if (caption || documentTitle) {\n                sharePayload.title = caption || documentTitle;\n            }\n\n            const options = buildShareOptions(sharePayload);\n\n            if (!options.length) {\n                debug.shareAction('no-options', { url: imageData.highResUrl });\n                syncShareControl();\n                return false;\n            }\n\n            populateShareModal(modalInstance, options, sharePayload);\n\n            const shareButton = viewer.querySelector('#mga-share');\n\n            const opened = openShareModal(modalInstance, shareButton || null);\n\n            if (!opened) {\n                return false;\n            }\n\n            return true;\n        }\n\n        function syncShareControl() {\n            const shouldShow = shouldDisplayShareButton();\n\n            if (shouldShow) {\n                registerShareToolbarHandler();\n            } else {\n                unregisterShareToolbarHandler();\n            }\n\n            const viewer = document.getElementById('mga-viewer');\n            if (!viewer) {\n                return;\n            }\n\n            const toolbar = viewer.querySelector('.mga-toolbar');\n            const shareButton = viewer.querySelector('#mga-share');\n\n            if (!shouldShow) {\n                if (shareModalIsOpen) {\n                    closeShareModal({ restoreFocus: false, reason: 'share-options-removed' });\n                }\n\n                if (shareButton) {\n                    shareButton.remove();\n                }\n\n                updateToolbarOptionalButtons(toolbar);\n                return;\n            }\n\n            if (!shareButton && toolbar) {\n                const newShareButton = createShareToolbarButton();\n                const fullscreenButton = toolbar.querySelector('#mga-fullscreen');\n                const closeButton = toolbar.querySelector('#mga-close');\n\n                if (fullscreenButton && fullscreenButton.parentElement === toolbar) {\n                    toolbar.insertBefore(newShareButton, fullscreenButton);\n                } else if (closeButton && closeButton.parentElement === toolbar) {\n                    toolbar.insertBefore(newShareButton, closeButton);\n                } else {\n                    toolbar.appendChild(newShareButton);\n                }\n            }\n\n            const ensuredModal = ensureShareModal(viewer);\n            if (ensuredModal) {\n                const refreshedShareButton = viewer.querySelector('#mga-share');\n                if (refreshedShareButton) {\n                    refreshedShareButton.setAttribute('aria-controls', 'mga-share-modal');\n                    refreshedShareButton.setAttribute('aria-expanded', 'false');\n                }\n            }\n\n            updateToolbarOptionalButtons(toolbar);\n        }\n\n        /**\n         * Swiper peut afficher des avertissements \u00AB\u00A0Swiper Loop Warning\u00A0\u00BB lorsque\n         * l'option `loop` est active mais que la configuration n'offre pas assez\n         * de diapositives. Plut\u00F4t que de modifier `console.warn`, on v\u00E9rifie\n         * localement que la configuration dispose d'un nombre de diapositives\n         * suffisant. Si ce n'est pas le cas, on d\u00E9sactive la boucle pour cette\n         * instance uniquement et on trace l'information via le logger de debug.\n         */\n        function createSwiperInstance(container, config) {\n            registerSwiperModules();\n\n            if (typeof Swiper !== 'function') {\n                const message = mga__( 'ERREUR\u00A0: La d\u00E9pendance Swiper est introuvable. Initialisation annul\u00E9e.', 'lightbox-jlg' );\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(message, true);\n                } else if (typeof console !== 'undefined' && typeof console.error === 'function') {\n                    console.error(message);\n                }\n                return null;\n            }\n            if (!config || !config.loop) {\n                return new Swiper(container, config);\n            }\n\n            const slidesCount = container ? container.querySelectorAll('.swiper-slide').length : 0;\n\n            const resolveMaxSlidesPerView = (swiperConfig) => {\n                const values = [];\n                const collect = (value) => {\n                    if (typeof value === 'number' && !Number.isNaN(value)) {\n                        values.push(Math.ceil(value));\n                    }\n                };\n\n                collect(swiperConfig.slidesPerView);\n\n                if (swiperConfig.breakpoints && typeof swiperConfig.breakpoints === 'object') {\n                    Object.values(swiperConfig.breakpoints).forEach(bpConfig => {\n                        if (bpConfig && typeof bpConfig === 'object') {\n                            collect(bpConfig.slidesPerView);\n                        }\n                    });\n                }\n\n                return values.length ? Math.max(...values) : 1;\n            };\n\n            const maxSlidesPerView = resolveMaxSlidesPerView(config);\n            const explicitLoopedSlides = typeof config.loopedSlides === 'number' ? Math.max(0, Math.floor(config.loopedSlides)) : maxSlidesPerView;\n            const additionalSlides = typeof config.loopAdditionalSlides === 'number' ? Math.max(0, Math.floor(config.loopAdditionalSlides)) : 0;\n            const slidesPerGroup = typeof config.slidesPerGroup === 'number' ? Math.max(1, Math.floor(config.slidesPerGroup)) : 1;\n            const centeredSlidesBonus = config.centeredSlides ? 1 : 0;\n\n            const computedLoopedSlides = explicitLoopedSlides + additionalSlides;\n            const minimumSlidesRequired = Math.max(computedLoopedSlides + 1, slidesPerGroup + centeredSlidesBonus + 1, 2);\n\n            if (slidesCount >= minimumSlidesRequired) {\n                return new Swiper(container, config);\n            }\n\n            const safeConfig = Object.assign({}, config);\n            let safeLoopedSlides = explicitLoopedSlides;\n            let safeAdditionalSlides = additionalSlides;\n\n            if (slidesCount > 1) {\n                safeLoopedSlides = Math.min(explicitLoopedSlides, Math.max(slidesCount - 1, 1));\n                const remainingCapacity = Math.max(slidesCount - 1 - safeLoopedSlides, 0);\n                safeAdditionalSlides = Math.min(additionalSlides, remainingCapacity);\n            } else {\n                safeConfig.loop = false;\n            }\n\n            safeConfig.loopedSlides = safeLoopedSlides;\n            safeConfig.loopAdditionalSlides = safeAdditionalSlides;\n\n            const logMessage = safeConfig.loop\n                ? `Loop ajust\u00E9e (instance locale) : ${slidesCount} slide(s), boucle recalibr\u00E9e \u00E0 ${safeLoopedSlides} + ${safeAdditionalSlides} slide(s) additionnelles.`\n                : `Loop d\u00E9sactiv\u00E9e (instance locale) : ${slidesCount} slide disponible, boucle inutilisable.`;\n\n            if (debug && typeof debug.log === 'function') {\n                debug.log(logMessage);\n            } else if (typeof console !== 'undefined' && typeof console.info === 'function') {\n                console.info(logMessage);\n            }\n\n            return new Swiper(container, safeConfig);\n        }\n\n        const DEVICE_WIDTH_PRESETS = [\n            { key: 'ultrawide', label: mga__( '\u00C9cran ultralarge', 'lightbox-jlg' ), minWidth: 1600 },\n            { key: 'desktop', label: mga__( 'Bureau', 'lightbox-jlg' ), minWidth: 1200 },\n            { key: 'tablet', label: mga__( 'Tablette', 'lightbox-jlg' ), minWidth: 768 },\n            { key: 'portrait', label: mga__( 'Portrait', 'lightbox-jlg' ), minWidth: 0 },\n        ];\n\n        const isFiniteSlidesValue = (value) => typeof value === 'number' && Number.isFinite(value) && !Number.isNaN(value);\n\n        const resolveSlidesPerViewSetting = (config, viewportWidth) => {\n            if (!config || typeof config !== 'object') {\n                return 1;\n            }\n\n            let resolved = config.slidesPerView;\n            const { breakpoints } = config;\n\n            if (breakpoints && typeof breakpoints === 'object') {\n                const candidates = Object.entries(breakpoints)\n                    .map(([breakpoint, breakpointConfig]) => ({\n                        width: parseFloat(breakpoint),\n                        config: breakpointConfig,\n                    }))\n                    .filter(({ width, config: breakpointConfig }) => (\n                        !Number.isNaN(width) &&\n                        viewportWidth >= width &&\n                        breakpointConfig &&\n                        typeof breakpointConfig === 'object'\n                    ))\n                    .sort((a, b) => a.width - b.width);\n\n                candidates.forEach(({ config: breakpointConfig }) => {\n                    if (Object.prototype.hasOwnProperty.call(breakpointConfig, 'slidesPerView')) {\n                        resolved = breakpointConfig.slidesPerView;\n                    }\n                });\n            }\n\n            if (isFiniteSlidesValue(resolved)) {\n                return Math.max(1, Math.ceil(resolved));\n            }\n\n            if (resolved === 'auto') {\n                return 'auto';\n            }\n\n            return 1;\n        };\n\n        const buildSlidesVisibilitySummary = (config) => DEVICE_WIDTH_PRESETS.map((preset) => ({\n            key: preset.key,\n            label: preset.label,\n            value: resolveSlidesPerViewSetting(config, preset.minWidth),\n        }));\n\n        const reportSlidesVisibility = (swiper, config) => {\n            if (!debug || typeof debug.updateVisibleSlides !== 'function') {\n                return;\n            }\n\n            const snapshot = buildSlidesVisibilitySummary(config);\n            const dynamicValue = swiper && typeof swiper.slidesPerViewDynamic === 'function'\n                ? swiper.slidesPerViewDynamic()\n                : null;\n\n            const formatted = snapshot.map(({ label, value }) => {\n                if (value === 'auto') {\n                    if (isFiniteSlidesValue(dynamicValue)) {\n                        return mgaSprintf(\n                            mga__( '%1$s\u00A0: auto (~%2$s)', 'lightbox-jlg' ),\n                            label,\n                            Math.max(1, Math.round(dynamicValue))\n                        );\n                    }\n\n                    return mgaSprintf(mga__( '%s\u00A0: auto', 'lightbox-jlg' ), label);\n                }\n\n                return mgaSprintf(\n                    mga__( '%1$s\u00A0: %2$s', 'lightbox-jlg' ),\n                    label,\n                    value\n                );\n            }).join(' | ');\n\n            debug.updateVisibleSlides(formatted);\n        };\n\n        // --- FONCTIONS UTILITAIRES ---\n\n        function slideToIndex(swiper, targetIndex, speed) {\n            if (!swiper || swiper.destroyed) {\n                return;\n            }\n\n            const args = [targetIndex];\n\n            if (typeof speed !== 'undefined') {\n                args.push(speed);\n            }\n\n            if (\n                swiper.params &&\n                swiper.params.loop &&\n                typeof swiper.slideToLoop === 'function'\n            ) {\n                swiper.slideToLoop.apply(swiper, args);\n                return;\n            }\n\n            if (typeof swiper.slideTo === 'function') {\n                swiper.slideTo.apply(swiper, args);\n            }\n        }\n\n        let focusSupportsOptionsCache = null;\n\n        function detectFocusOptionsSupport() {\n            if (focusSupportsOptionsCache !== null) {\n                return focusSupportsOptionsCache;\n            }\n\n            focusSupportsOptionsCache = false;\n\n            if (\n                typeof window === 'undefined' ||\n                typeof document === 'undefined' ||\n                typeof document.createElement !== 'function' ||\n                typeof HTMLElement === 'undefined' ||\n                !HTMLElement.prototype ||\n                typeof HTMLElement.prototype.focus !== 'function'\n            ) {\n                return focusSupportsOptionsCache;\n            }\n\n            const testElement = document.createElement('button');\n            const root = document.body || document.documentElement;\n\n            try {\n                testElement.type = 'button';\n\n                if (root && typeof root.appendChild === 'function') {\n                    root.appendChild(testElement);\n                }\n\n                HTMLElement.prototype.focus.call(testElement, {\n                    get preventScroll() {\n                        focusSupportsOptionsCache = true;\n                        return true;\n                    },\n                });\n            } catch (error) {\n                focusSupportsOptionsCache = false;\n            } finally {\n                if (testElement.parentNode && typeof testElement.parentNode.removeChild === 'function') {\n                    testElement.parentNode.removeChild(testElement);\n                }\n            }\n\n            return focusSupportsOptionsCache;\n        }\n\n        function safeFocus(element, options = { preventScroll: true }) {\n            if (!element || typeof element.focus !== 'function') {\n                return;\n            }\n\n            const canUseOptions = options && detectFocusOptionsSupport();\n\n            if (canUseOptions) {\n                try {\n                    element.focus(options);\n                    return;\n                } catch (error) {\n                    // Fallback to focusing without options if an error occurs.\n                }\n            }\n\n            element.focus();\n        }\n\n        function resolveFullscreenApi(target) {\n            const doc = document;\n            const apiMap = [\n                { request: 'requestFullscreen', exit: 'exitFullscreen', element: 'fullscreenElement' },\n                { request: 'webkitRequestFullscreen', exit: 'webkitExitFullscreen', element: 'webkitFullscreenElement' },\n                { request: 'webkitRequestFullScreen', exit: 'webkitCancelFullScreen', element: 'webkitCurrentFullScreenElement' },\n                { request: 'mozRequestFullScreen', exit: 'mozCancelFullScreen', element: 'mozFullScreenElement' },\n                { request: 'msRequestFullscreen', exit: 'msExitFullscreen', element: 'msFullscreenElement' },\n            ];\n\n            const result = {\n                request: null,\n                exit: null,\n                element: null,\n            };\n\n            const elementCandidates = [\n                'fullscreenElement',\n                'webkitFullscreenElement',\n                'webkitCurrentFullScreenElement',\n                'mozFullScreenElement',\n                'msFullscreenElement',\n            ];\n\n            for (const prop of elementCandidates) {\n                if (typeof doc[prop] !== 'undefined' && doc[prop]) {\n                    result.element = doc[prop];\n                    break;\n                }\n            }\n\n            for (const entry of apiMap) {\n                if (!result.request && target && typeof target[entry.request] === 'function') {\n                    result.request = target[entry.request].bind(target);\n                }\n                if (!result.exit && typeof doc[entry.exit] === 'function') {\n                    result.exit = doc[entry.exit].bind(doc);\n                }\n                if (result.request && result.exit && result.element) {\n                    break;\n                }\n            }\n\n            return result;\n        }\n\n        function isExplicitFallbackAllowed(linkElement) {\n            if (!linkElement) return false;\n            if (linkElement.hasAttribute('data-mga-allow-fallback')) return true;\n            if (linkElement.dataset) {\n                const allowFlag = linkElement.dataset.mgaAllowFallback;\n                if (typeof allowFlag !== 'undefined' && allowFlag !== '0' && allowFlag !== 'false') {\n                    return true;\n                }\n                if (linkElement.dataset.mgaHighres) {\n                    return true;\n                }\n                const linkType = linkElement.dataset.type || linkElement.dataset.wpType;\n                if (typeof linkType === 'string' && linkType.toLowerCase() === 'attachment') {\n                    return true;\n                }\n            }\n            const rel = linkElement.getAttribute('rel');\n            if (rel && rel.split(/\\s+/).includes('mga-allow-fallback')) {\n                return true;\n            }\n            const dataType = linkElement.getAttribute('data-type');\n            if (typeof dataType === 'string' && dataType.toLowerCase() === 'attachment') {\n                return true;\n            }\n            const href = linkElement.getAttribute('href');\n            if (typeof href === 'string') {\n                if (/[?&]attachment_id=\\d+/i.test(href)) {\n                    return true;\n                }\n                if (/\\/attachment\\//i.test(href)) {\n                    return true;\n                }\n                try {\n                    const baseHref = (typeof window !== 'undefined' && window.location)\n                        ? window.location.href\n                        : undefined;\n                    const url = new URL(href, baseHref);\n                    if (url.searchParams && url.searchParams.has('attachment_id')) {\n                        return true;\n                    }\n                } catch (error) {\n                    // Ignored : l'URL relative sera d\u00E9j\u00E0 couverte par les expressions r\u00E9guli\u00E8res ci-dessus.\n                }\n            }\n            return false;\n        }\n\n        function getImageDataAttributes(innerImg, options = {}) {\n            if (!innerImg) return null;\n\n            const { excludeLarge = false } = options;\n\n            const attributePriority = [\n                'data-mga-highres',\n                'data-full-url',\n                'data-large-file',\n                'data-orig-file',\n                'data-src',\n                'data-lazy-src'\n            ];\n            const datasetToAttributesMap = {\n                mgaHighres: 'data-mga-highres',\n                fullUrl: 'data-full-url',\n                largeFile: 'data-large-file',\n                origFile: 'data-orig-file',\n                src: 'data-src',\n                lazySrc: 'data-lazy-src'\n            };\n            const collected = [];\n\n            for (const attr of attributePriority) {\n                const value = innerImg.getAttribute(attr);\n                if (value) {\n                    collected.push({ key: attr, value: value.trim() });\n                }\n            }\n\n            if (innerImg.dataset) {\n                for (const [datasetKey, attributeName] of Object.entries(datasetToAttributesMap)) {\n                    const datasetValue = innerImg.dataset[datasetKey];\n                    if (datasetValue && !collected.some(item => item.key === attributeName)) {\n                        collected.push({ key: attributeName, value: datasetValue.trim() });\n                    }\n                }\n            }\n\n            if (!collected.length) {\n                return null;\n            }\n\n            if (excludeLarge) {\n                const largeKeys = new Set(['data-full-url', 'data-large-file', 'data-orig-file']);\n                const lightweightPreference = ['data-src', 'data-lazy-src', 'data-mga-highres'];\n                const hasLightweightAlternative = collected.some(item => !largeKeys.has(item.key));\n\n                if (hasLightweightAlternative) {\n                    for (const preferredKey of lightweightPreference) {\n                        const candidate = collected.find(item => item.key === preferredKey && item.value);\n                        if (candidate) {\n                            return candidate.value;\n                        }\n                    }\n\n                    const fallbackCandidate = collected.find(item => !largeKeys.has(item.key) && item.value);\n                    if (fallbackCandidate) {\n                        return fallbackCandidate.value;\n                    }\n                }\n            }\n\n            const firstEntry = collected.find(item => item.value);\n            return firstEntry ? firstEntry.value : null;\n        }\n\n        function sanitizeThumbnailUrl(candidate) {\n            if (typeof candidate !== 'string') {\n                return '';\n            }\n\n            const trimmed = candidate.trim();\n            if (!trimmed) {\n                return '';\n            }\n\n            if (/^(?:about:|javascript:)/i.test(trimmed)) {\n                return '';\n            }\n\n            if (/^(?:data:|blob:)/i.test(trimmed)) {\n                return '';\n            }\n\n            return trimmed;\n        }\n\n        function sanitizeHighResUrl(candidate) {\n            if (typeof candidate !== 'string') {\n                return '';\n            }\n\n            const trimmed = candidate.trim();\n            if (!trimmed) {\n                return '';\n            }\n\n            if (/^\\/\\//.test(trimmed)) {\n                const location = typeof window !== 'undefined' ? window.location : null;\n                const protocol = location && typeof location.protocol === 'string'\n                    ? location.protocol.toLowerCase()\n                    : '';\n                if (protocol === 'http:' || protocol === 'https:') {\n                    return `${protocol}${trimmed}`;\n                }\n                return `https:${trimmed}`;\n            }\n\n            if (/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(trimmed)) {\n                if (!/^https?:/i.test(trimmed)) {\n                    return '';\n                }\n                return trimmed;\n            }\n\n            return trimmed;\n        }\n\n        function resolveThumbnailUrl(innerImg) {\n            if (!innerImg) {\n                return '';\n            }\n\n            const preferredSources = [\n                typeof innerImg.currentSrc === 'string' ? innerImg.currentSrc : '',\n                typeof innerImg.src === 'string' ? innerImg.src : '',\n            ];\n\n            for (const source of preferredSources) {\n                const sanitized = sanitizeThumbnailUrl(source);\n                if (sanitized) {\n                    return sanitized;\n                }\n            }\n\n            const dataAttributeUrl = getImageDataAttributes(innerImg, { excludeLarge: true });\n            return sanitizeThumbnailUrl(dataAttributeUrl);\n        }\n\n        function parseSrcset(innerImg) {\n            if (!innerImg || !innerImg.srcset) {\n                return null;\n            }\n\n            const entries = innerImg.srcset\n                .split(',')\n                .map(entry => entry.trim())\n                .filter(entry => entry.length > 0)\n                .map(entry => {\n                    const parts = entry.split(/\\s+/);\n                    const candidateUrl = parts[0];\n                    let score = 0;\n                    if (parts[1]) {\n                        const descriptor = parts[1].trim();\n                        if (/^[0-9]+w$/i.test(descriptor)) {\n                            score = parseInt(descriptor, 10);\n                        } else if (/^[0-9]*\\.?[0-9]+x$/i.test(descriptor)) {\n                            score = parseFloat(descriptor) * 1000;\n                        }\n                    }\n                    return { url: candidateUrl, score };\n                })\n                .filter(candidate => candidate.url);\n\n            if (!entries.length) {\n                return null;\n            }\n\n            entries.sort((a, b) => b.score - a.score);\n            return entries[0].url;\n        }\n\n        function getHighResUrl(linkElement) {\n            if (!linkElement) return null;\n\n            const href = linkElement.getAttribute('href') || '';\n            if (!includeSvg && isSvgLikeUrl(href)) {\n                return null;\n            }\n            const isMediaHref = IMAGE_FILE_PATTERN.test(href);\n            const fallbackAllowed = isMediaHref || isExplicitFallbackAllowed(linkElement);\n            const sanitizedHref = isMediaHref ? sanitizeHighResUrl(href) : null;\n\n            if (fallbackAllowed && linkElement.dataset && linkElement.dataset.mgaHighres) {\n                const sanitizedDatasetUrl = sanitizeHighResUrl(linkElement.dataset.mgaHighres);\n                if (sanitizedDatasetUrl && (includeSvg || !isSvgLikeUrl(sanitizedDatasetUrl))) {\n                    return sanitizedDatasetUrl;\n                }\n            }\n\n            const innerImg = linkElement.querySelector('img');\n            if (!innerImg) return null;\n\n            if (fallbackAllowed) {\n                const dataAttrUrl = getImageDataAttributes(innerImg);\n                const sanitizedDataAttrUrl = sanitizeHighResUrl(dataAttrUrl);\n                if (sanitizedDataAttrUrl && (includeSvg || !isSvgLikeUrl(sanitizedDataAttrUrl))) {\n                    return sanitizedDataAttrUrl;\n                }\n            }\n\n            if (!fallbackAllowed) {\n                return null;\n            }\n\n            const srcsetUrl = sanitizeHighResUrl(parseSrcset(innerImg));\n            if (srcsetUrl && (includeSvg || !isSvgLikeUrl(srcsetUrl))) {\n                return srcsetUrl;\n            }\n\n            if (sanitizedHref && (includeSvg || !isSvgLikeUrl(sanitizedHref))) {\n                return sanitizedHref;\n            }\n\n            const currentSrc = sanitizeHighResUrl(innerImg.currentSrc);\n            if (currentSrc && (includeSvg || !isSvgLikeUrl(currentSrc))) {\n                return currentSrc;\n            }\n\n            const fallbackSrc = sanitizeHighResUrl(innerImg.src);\n            if (fallbackSrc && (includeSvg || !isSvgLikeUrl(fallbackSrc))) {\n                return fallbackSrc;\n            }\n\n            return null;\n        }\n\n        const CTA_VARIANTS = new Set(['primary', 'secondary', 'outline']);\n\n        const sanitizeCtaVariant = (value) => {\n            if (typeof value !== 'string') {\n                return 'primary';\n            }\n\n            const normalized = value.trim().toLowerCase();\n            return CTA_VARIANTS.has(normalized) ? normalized : 'primary';\n        };\n\n        const sanitizeCtaTarget = (value) => {\n            if (typeof value !== 'string') {\n                return '_self';\n            }\n\n            const normalized = value.trim().toLowerCase();\n            switch (normalized) {\n                case '_blank':\n                case '_self':\n                case '_parent':\n                case '_top':\n                    return normalized;\n                default:\n                    return '_self';\n            }\n        };\n\n        const sanitizeCtaRel = (value, target) => {\n            if (typeof value === 'string' && value.trim()) {\n                return value.trim();\n            }\n\n            if (target === '_blank') {\n                return 'noopener noreferrer';\n            }\n\n            return '';\n        };\n\n        const createCtaEntry = (raw) => {\n            if (!raw || typeof raw !== 'object') {\n                return null;\n            }\n\n            const label = typeof raw.label === 'string' ? raw.label.trim() : '';\n            const url = typeof raw.url === 'string' ? raw.url.trim() : '';\n\n            if (!label || !url) {\n                return null;\n            }\n\n            const target = sanitizeCtaTarget(raw.target);\n            const rel = sanitizeCtaRel(raw.rel, target);\n            const variant = sanitizeCtaVariant(raw.variant);\n\n            return { label, url, target, rel, variant };\n        };\n\n        const parseCtaDefinitionList = (value) => {\n            if (typeof value !== 'string' || !value.trim()) {\n                return [];\n            }\n\n            try {\n                const parsed = JSON.parse(value);\n                if (Array.isArray(parsed)) {\n                    return parsed.map(createCtaEntry).filter(Boolean);\n                }\n\n                const single = createCtaEntry(parsed);\n                return single ? [single] : [];\n            } catch (error) {\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(mgaSprintf(mga__( 'Impossible de parser les CTA personnalis\u00E9s\u00A0: %s', 'lightbox-jlg' ), error.message), true);\n                }\n            }\n\n            return [];\n        };\n\n        const readAttribute = (element, attributeName) => {\n            if (!element) {\n                return '';\n            }\n\n            const rawValue = element.getAttribute(attributeName);\n            return typeof rawValue === 'string' ? rawValue.trim() : '';\n        };\n\n        const collectSingleCta = (element, prefix, fallbackVariant) => {\n            if (!element) {\n                return null;\n            }\n\n            const label = readAttribute(element, `${prefix}-label`);\n            const url = readAttribute(element, `${prefix}-url`);\n\n            if (!label || !url) {\n                return null;\n            }\n\n            const target = readAttribute(element, `${prefix}-target`) || undefined;\n            const rel = readAttribute(element, `${prefix}-rel`) || undefined;\n            const variantAttribute = readAttribute(element, `${prefix}-variant`) || fallbackVariant;\n\n            return createCtaEntry({\n                label,\n                url,\n                target,\n                rel,\n                variant: variantAttribute || fallbackVariant,\n            });\n        };\n\n        const extractCallToActions = (linkElement, imageElement) => {\n            const sources = [];\n            if (linkElement instanceof Element) {\n                sources.push(linkElement);\n            }\n            if (imageElement instanceof Element) {\n                sources.push(imageElement);\n            }\n\n            const collected = [];\n            const seen = new Set();\n\n            const append = (entry) => {\n                if (!entry) {\n                    return;\n                }\n\n                const key = `${entry.label}::${entry.url}`;\n                if (seen.has(key)) {\n                    return;\n                }\n\n                seen.add(key);\n                collected.push(entry);\n            };\n\n            sources.forEach((node) => {\n                if (!node) {\n                    return;\n                }\n\n                const jsonDefinitions = parseCtaDefinitionList(readAttribute(node, 'data-mga-cta'));\n                jsonDefinitions.forEach(append);\n\n                append(collectSingleCta(node, 'data-mga-cta', 'primary'));\n                append(collectSingleCta(node, 'data-mga-cta-secondary', 'secondary'));\n            });\n\n            return collected;\n        };\n\n        const buildGalleryDataFromLinks = (triggerLinks) => {\n            if (!Array.isArray(triggerLinks) || !triggerLinks.length) {\n                return [];\n            }\n\n            return triggerLinks.reduce((accumulator, link, index) => {\n                const innerImg = link.querySelector('img');\n                if (!innerImg) {\n                    return accumulator;\n                }\n\n                const highResUrl = getHighResUrl(link);\n                if (!highResUrl) {\n                    return accumulator;\n                }\n\n                if (!includeSvg && isSvgLikeUrl(highResUrl)) {\n                    return accumulator;\n                }\n\n                let thumbUrl = resolveThumbnailUrl(innerImg);\n                if (!thumbUrl) {\n                    const fallbackThumbUrl = sanitizeThumbnailUrl(highResUrl);\n                    if (fallbackThumbUrl) {\n                        thumbUrl = fallbackThumbUrl;\n                    }\n                }\n\n                if (!thumbUrl) {\n                    return accumulator;\n                }\n\n                let caption = '';\n                const figure = link.closest('figure');\n                if (figure) {\n                    const figcaption = figure.querySelector('figcaption');\n                    if (figcaption) {\n                        caption = figcaption.textContent.trim();\n                    }\n                }\n\n                if (!caption) {\n                    caption = innerImg.alt || '';\n                }\n\n                const ctas = extractCallToActions(link, innerImg);\n\n                accumulator.push({\n                    highResUrl,\n                    thumbUrl,\n                    caption,\n                    triggerIndex: index,\n                    ctas,\n                });\n\n                return accumulator;\n            }, []);\n        };\n\n        const openViewerWithData = (galleryId, galleryData, startIndex, options = {}) => {\n            if (!Array.isArray(galleryData) || !galleryData.length) {\n                return false;\n            }\n\n            const sanitizedStartIndex = Math.max(\n                0,\n                Math.min(parseInt(startIndex, 10) || 0, galleryData.length - 1)\n            );\n\n            const focusOrigin = options.focusOrigin instanceof Element\n                ? options.focusOrigin\n                : (options.focusOrigin === null ? null : undefined);\n\n            let capturedFocusElement = null;\n\n            if (focusOrigin) {\n                capturedFocusElement = focusOrigin;\n                lastFocusedElementBeforeViewer = focusOrigin;\n            } else if (!options.skipFocusCapture) {\n                const activeElement = document && document.activeElement instanceof Element\n                    ? document.activeElement\n                    : null;\n                if (activeElement) {\n                    capturedFocusElement = activeElement;\n                    lastFocusedElementBeforeViewer = activeElement;\n                }\n            }\n\n            const historyConfig = options.history || {};\n\n            const viewerOpened = openViewer(galleryData, sanitizedStartIndex, {\n                galleryId,\n                history: historyConfig,\n            });\n\n            if (!viewerOpened && capturedFocusElement && capturedFocusElement === lastFocusedElementBeforeViewer) {\n                lastFocusedElementBeforeViewer = null;\n            }\n\n            return viewerOpened;\n        };\n\n        const parseDeepLinkFromUrl = () => {\n            if (typeof window === 'undefined' || typeof window.location === 'undefined') {\n                return null;\n            }\n\n            try {\n                const currentUrl = new URL(window.location.href);\n                const rawValue = currentUrl.searchParams.get('mga');\n                if (!rawValue) {\n                    return null;\n                }\n\n                const separatorIndex = rawValue.lastIndexOf(':');\n                if (separatorIndex === -1) {\n                    return null;\n                }\n\n                const encodedGalleryId = rawValue.slice(0, separatorIndex);\n                const slidePart = rawValue.slice(separatorIndex + 1);\n                if (!encodedGalleryId) {\n                    return null;\n                }\n\n                const galleryId = decodeURIComponent(encodedGalleryId);\n                if (!galleryId) {\n                    return null;\n                }\n\n                const slideNumber = parseInt(slidePart, 10);\n                const index = Number.isNaN(slideNumber) ? 0 : Math.max(slideNumber - 1, 0);\n\n                const sanitizedUrl = new URL(currentUrl.toString());\n                sanitizedUrl.searchParams.delete('mga');\n\n                return {\n                    galleryId,\n                    index,\n                    originalUrl: sanitizedUrl.toString(),\n                    originalState: window.history.state,\n                };\n            } catch (error) {\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(mgaSprintf(mga__( 'Lien profond invalide d\u00E9tect\u00E9\u00A0: %s', 'lightbox-jlg' ), error.message), true);\n                }\n                return null;\n            }\n        };\n\n        let pendingDeepLink = parseDeepLinkFromUrl();\n\n        function getViewer() {\n            let viewer = document.getElementById('mga-viewer');\n            if (!viewer) {\n                debug.log(mga__( 'Viewer non trouv\u00E9. Cr\u00E9ation \u00E0 la vol\u00E9e...', 'lightbox-jlg' ));\n\n                viewer = document.createElement('div');\n                viewer.id = 'mga-viewer';\n                viewer.className = 'mga-viewer mga-viewer--compact';\n                viewer.classList.toggle('mga-has-caption', false);\n                viewer.style.display = 'none';\n                viewer.setAttribute('role', 'dialog');\n                viewer.setAttribute('aria-modal', 'true');\n                viewer.setAttribute('aria-labelledby', 'mga-viewer-title');\n                viewer.setAttribute('tabindex', '-1');\n\n                const viewerTitle = document.createElement('span');\n                viewerTitle.id = 'mga-viewer-title';\n                viewerTitle.className = 'mga-screen-reader-text';\n                viewerTitle.textContent = mga__( 'Visionneuse d\u2019images', 'lightbox-jlg' );\n                viewer.appendChild(viewerTitle);\n\n                const echoBg = document.createElement('div');\n                echoBg.className = 'mga-echo-bg';\n                viewer.appendChild(echoBg);\n\n                const header = document.createElement('div');\n                header.className = 'mga-header';\n                viewer.appendChild(header);\n\n                const counter = document.createElement('div');\n                counter.id = 'mga-counter';\n                counter.className = 'mga-counter';\n                header.appendChild(counter);\n\n                const captionContainer = document.createElement('div');\n                captionContainer.className = 'mga-caption-container';\n                captionContainer.setAttribute('role', 'status');\n                captionContainer.setAttribute('aria-live', 'polite');\n                header.appendChild(captionContainer);\n\n                const caption = document.createElement('p');\n                caption.id = 'mga-caption';\n                caption.className = 'mga-caption';\n                captionContainer.appendChild(caption);\n\n                const captionLiveRegion = document.createElement('span');\n                captionLiveRegion.className = 'mga-screen-reader-text mga-caption-live';\n                captionContainer.appendChild(captionLiveRegion);\n\n                const captionFeedback = document.createElement('p');\n                captionFeedback.className = 'mga-caption-feedback';\n                captionFeedback.setAttribute('hidden', 'hidden');\n                captionContainer.appendChild(captionFeedback);\n\n                const ctaContainer = document.createElement('div');\n                ctaContainer.className = 'mga-cta-container';\n                ctaContainer.setAttribute('data-mga-cta-container', 'true');\n                ctaContainer.setAttribute('hidden', 'hidden');\n                header.appendChild(ctaContainer);\n\n                const toolbar = document.createElement('div');\n                toolbar.className = 'mga-toolbar';\n                header.appendChild(toolbar);\n\n                const playPauseButton = document.createElement('button');\n                playPauseButton.type = 'button';\n                playPauseButton.id = 'mga-play-pause';\n                playPauseButton.className = 'mga-toolbar-button';\n                playPauseButton.setAttribute('aria-pressed', 'false');\n                playPauseButton.setAttribute('aria-label', mga__( 'Lancer le diaporama', 'lightbox-jlg' ));\n                toolbar.appendChild(playPauseButton);\n\n                const timerSvg = createSvgElement('svg', { class: 'mga-timer-svg', viewBox: '0 0 36 36' });\n                const timerBgPath = createSvgElement('path', {\n                    class: 'mga-timer-bg',\n                    d: 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831',\n                });\n                const timerProgressPath = createSvgElement('path', {\n                    class: 'mga-timer-progress',\n                    d: 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831',\n                });\n                timerSvg.appendChild(timerBgPath);\n                timerSvg.appendChild(timerProgressPath);\n                playPauseButton.appendChild(timerSvg);\n\n                const playIcon = createSvgElement('svg', {\n                    class: 'mga-icon mga-play-icon',\n                    viewBox: '0 0 24 24',\n                    fill: 'currentColor',\n                });\n                const playPath = createSvgElement('path', { d: 'M8 5v14l11-7z' });\n                playIcon.appendChild(playPath);\n                playPauseButton.appendChild(playIcon);\n\n                const pauseIcon = createSvgElement('svg', {\n                    class: 'mga-icon mga-pause-icon',\n                    viewBox: '0 0 24 24',\n                    fill: 'currentColor',\n                });\n                pauseIcon.style.display = 'none';\n                const pausePath = createSvgElement('path', { d: 'M6 19h4V5H6v14zm8-14v14h4V5h-4z' });\n                pauseIcon.appendChild(pausePath);\n                playPauseButton.appendChild(pauseIcon);\n\n                updateAutoplayButtonState(viewer, false);\n\n                if (showZoom) {\n                    const zoomButton = document.createElement('button');\n                    zoomButton.type = 'button';\n                    zoomButton.id = 'mga-zoom';\n                    zoomButton.className = 'mga-toolbar-button';\n                    zoomButton.setAttribute('aria-label', mga__( 'Zoom', 'lightbox-jlg' ));\n                    toolbar.appendChild(zoomButton);\n\n                    const zoomIcon = createSvgElement('svg', {\n                        class: 'mga-icon',\n                        viewBox: '0 0 24 24',\n                        fill: 'currentColor',\n                    });\n                    const zoomPrimaryPath = createSvgElement('path', {\n                        d: 'M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z',\n                    });\n                    const zoomSecondaryPath = createSvgElement('path', {\n                        d: 'M10 9h-1v-1H8v1H7v1h1v1h1v-1h1V9z',\n                    });\n                    zoomIcon.appendChild(zoomPrimaryPath);\n                    zoomIcon.appendChild(zoomSecondaryPath);\n                    zoomButton.appendChild(zoomIcon);\n                }\n\n                if (showDownload) {\n                    const downloadButton = document.createElement('button');\n                    downloadButton.type = 'button';\n                    downloadButton.id = 'mga-download';\n                    downloadButton.className = 'mga-toolbar-button';\n                    downloadButton.setAttribute('aria-label', mga__( 'T\u00E9l\u00E9charger l\u2019image', 'lightbox-jlg' ));\n                    toolbar.appendChild(downloadButton);\n\n                    const downloadIcon = createSvgElement('svg', {\n                        class: 'mga-icon mga-download-icon',\n                        viewBox: '0 0 24 24',\n                        fill: 'currentColor',\n                    });\n                    const downloadArrow = createSvgElement('path', {\n                        d: 'M5 20h14v-2H5v2zm7-16l-5 5h3v4h4v-4h3l-5-5z',\n                    });\n                    downloadIcon.appendChild(downloadArrow);\n                    downloadButton.appendChild(downloadIcon);\n                }\n\n                if (shouldDisplayShareButton()) {\n                    const shareButton = createShareToolbarButton();\n                    toolbar.appendChild(shareButton);\n                }\n\n                if (showFullscreen) {\n                    const fullscreenButton = document.createElement('button');\n                    fullscreenButton.type = 'button';\n                    fullscreenButton.id = 'mga-fullscreen';\n                    fullscreenButton.className = 'mga-toolbar-button';\n                    fullscreenButton.setAttribute('aria-label', mga__( 'Plein \u00E9cran', 'lightbox-jlg' ));\n                    toolbar.appendChild(fullscreenButton);\n\n                    const fullscreenIcon = createSvgElement('svg', {\n                        class: 'mga-icon',\n                        viewBox: '0 0 24 24',\n                        fill: 'currentColor',\n                    });\n                    const fullscreenPath = createSvgElement('path', {\n                        d: 'M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5V14h-2v3zM14 5v2h3v3h2V5h-5z',\n                    });\n                    fullscreenIcon.appendChild(fullscreenPath);\n                    fullscreenButton.appendChild(fullscreenIcon);\n                }\n\n                toolbar.setAttribute('data-mga-optional-buttons', String(optionalToolbarHandlers.length));\n\n                const closeButton = document.createElement('button');\n                closeButton.type = 'button';\n                closeButton.id = 'mga-close';\n                closeButton.className = 'mga-toolbar-button';\n                closeButton.setAttribute('aria-label', mga__( 'Fermer', 'lightbox-jlg' ));\n                toolbar.appendChild(closeButton);\n\n                const closeIcon = createSvgElement('svg', {\n                    class: 'mga-icon',\n                    viewBox: '0 0 24 24',\n                    fill: 'currentColor',\n                });\n                const closePath = createSvgElement('path', {\n                    d: 'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z',\n                });\n                closeIcon.appendChild(closePath);\n                closeButton.appendChild(closeIcon);\n\n                const mainSwiper = document.createElement('div');\n                mainSwiper.className = 'swiper mga-main-swiper';\n                viewer.appendChild(mainSwiper);\n\n                const mainWrapper = document.createElement('div');\n                mainWrapper.className = 'swiper-wrapper';\n                mainWrapper.id = 'mga-main-wrapper';\n                mainSwiper.appendChild(mainWrapper);\n\n                const nextButton = document.createElement('button');\n                nextButton.type = 'button';\n                nextButton.className = 'swiper-button-next mga-nav-button';\n                nextButton.id = 'mga-next';\n                nextButton.setAttribute('aria-label', mga__( 'Image suivante', 'lightbox-jlg' ));\n                nextButton.setAttribute('title', mga__( 'Image suivante', 'lightbox-jlg' ));\n                mainSwiper.appendChild(nextButton);\n\n                const prevButton = document.createElement('button');\n                prevButton.type = 'button';\n                prevButton.className = 'swiper-button-prev mga-nav-button';\n                prevButton.id = 'mga-prev';\n                prevButton.setAttribute('aria-label', mga__( 'Image pr\u00E9c\u00E9dente', 'lightbox-jlg' ));\n                prevButton.setAttribute('title', mga__( 'Image pr\u00E9c\u00E9dente', 'lightbox-jlg' ));\n                mainSwiper.appendChild(prevButton);\n\n                if (thumbsLayout !== 'hidden') {\n                    const thumbsSwiper = document.createElement('div');\n                    thumbsSwiper.className = 'swiper mga-thumbs-swiper';\n                    viewer.appendChild(thumbsSwiper);\n\n                    const thumbsWrapper = document.createElement('div');\n                    thumbsWrapper.className = 'swiper-wrapper';\n                    thumbsWrapper.id = 'mga-thumbs-wrapper';\n                    thumbsSwiper.appendChild(thumbsWrapper);\n                }\n\n                if (shouldDisplayShareButton()) {\n                    const createdShareModal = ensureShareModal(viewer);\n                    if (createdShareModal) {\n                        const shareButtonElement = viewer.querySelector('#mga-share');\n                        if (shareButtonElement) {\n                            shareButtonElement.setAttribute('aria-controls', 'mga-share-modal');\n                        }\n                    }\n                }\n\n                if (document.body && typeof document.body.appendChild === 'function') {\n                    document.body.appendChild(viewer);\n                }\n\n                if (viewer && viewer.parentNode) debug.log(mga__( 'Viewer cr\u00E9\u00E9 et ajout\u00E9 au body avec succ\u00E8s.', 'lightbox-jlg' ));\n                else debug.log(mga__( 'ERREUR CRITIQUE\u00A0: \u00C9chec de la cr\u00E9ation du viewer\u00A0!', 'lightbox-jlg' ), true);\n            }\n            return viewer;\n        }\n\n        // --- LOGIQUE PRINCIPALE ---\n        debug.log(mga__( 'Script initialis\u00E9 et pr\u00EAt.', 'lightbox-jlg' ));\n        debug.updateInfo('mga-debug-status', mga__( 'Pr\u00EAt', 'lightbox-jlg' ), '#4CAF50');\n\n        const defaultContentSelectors = [\n            '.wp-block-post-content',\n            '.entry-content',\n            '.post-content',\n            '.site-main',\n            '.content-area',\n            'main',\n            '.hentry',\n            '#primary',\n            '#main'\n        ];\n        const configuredSelectors = Array.isArray(settings.contentSelectors) ? settings.contentSelectors : [];\n        const contentSelectors = Array.from(\n            new Set(configuredSelectors.concat(defaultContentSelectors).filter(Boolean))\n        );\n        let contentArea = null;\n        let foundSelector = mga__( 'Aucune zone d\u00E9tect\u00E9e', 'lightbox-jlg' );\n        for (const selector of contentSelectors) {\n            let area = null;\n\n            try {\n                area = document.querySelector(selector);\n            } catch (error) {\n                const errorMessage = mgaSprintf(\n                    mga__( 'S\u00E9lecteur CSS invalide ignor\u00E9\u00A0: %s', 'lightbox-jlg' ),\n                    selector\n                );\n                const errorDetails = error && error.message ? ` (${error.message})` : '';\n                const logMessage = `${errorMessage}${errorDetails}`;\n\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(logMessage, true);\n                } else if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n                    console.warn(logMessage);\n                }\n\n                continue;\n            }\n\n            if (area) {\n                contentArea = area;\n                foundSelector = selector;\n                break;\n            }\n        }\n\n        if (!contentArea && settings.allowBodyFallback === true && document.body) {\n            contentArea = document.body;\n            foundSelector = mga__( '<body> (opt-in fallback)', 'lightbox-jlg' );\n        }\n\n        if (!contentArea) {\n            debug.updateInfo('mga-debug-content-area', foundSelector, '#F44336');\n            debug.log(mga__( 'Aucune zone de contenu valide d\u00E9tect\u00E9e. Initialisation du diaporama interrompue.', 'lightbox-jlg' ), true);\n            return;\n        }\n\n        debug.updateInfo('mga-debug-content-area', foundSelector, '#4CAF50');\n        \n        const FALLBACK_GROUP_ID = '__mga-default-group__';\n        const configuredGroupAttribute = typeof settings.groupAttribute === 'string'\n            ? settings.groupAttribute.trim()\n            : '';\n\n        const REL_GROUP_PREFIX = 'mga-group:';\n        const GENERIC_REL_TOKENS = new Set(['nofollow', 'noreferrer', 'noopener', 'opener', 'external']);\n\n        const extractRelGroupToken = (relValue) => {\n            if (typeof relValue !== 'string') {\n                return null;\n            }\n\n            const tokens = relValue\n                .split(/\\s+/)\n                .map(token => token.trim())\n                .filter(Boolean);\n\n            for (const token of tokens) {\n                if (token.toLowerCase().startsWith(REL_GROUP_PREFIX)) {\n                    const suffix = token.slice(REL_GROUP_PREFIX.length).trim();\n                    if (suffix) {\n                        return suffix;\n                    }\n                }\n            }\n\n            for (const token of tokens) {\n                const normalized = token.toLowerCase();\n                if (!normalized || GENERIC_REL_TOKENS.has(normalized)) {\n                    continue;\n                }\n\n                if (normalized.includes(':')) {\n                    continue;\n                }\n\n                return token;\n            }\n\n            return null;\n        };\n\n        const resolveLinkGroupId = (link) => {\n            if (!(link instanceof Element)) {\n                return FALLBACK_GROUP_ID;\n            }\n\n            const relGroupToken = extractRelGroupToken(link.getAttribute('rel'));\n            if (relGroupToken) {\n                return `rel:${relGroupToken}`;\n            }\n\n            const attributeCandidates = [];\n\n            if (configuredGroupAttribute) {\n                attributeCandidates.push(configuredGroupAttribute);\n            }\n\n            attributeCandidates.push('data-mga-gallery');\n\n            const normalizedConfiguredGroupAttribute = configuredGroupAttribute\n                ? configuredGroupAttribute.toLowerCase()\n                : '';\n\n            for (const attrName of attributeCandidates) {\n                if (!attrName) {\n                    continue;\n                }\n\n                if (attrName.toLowerCase() === 'rel') {\n                    continue;\n                }\n\n                const rawValue = link.getAttribute(attrName);\n                if (typeof rawValue !== 'string') {\n                    continue;\n                }\n\n                const trimmed = rawValue.trim();\n                if (!trimmed) {\n                    continue;\n                }\n\n                return `${attrName}:${trimmed}`;\n            }\n\n            if (normalizedConfiguredGroupAttribute === 'href') {\n                const hrefValue = link.getAttribute('href');\n                if (typeof hrefValue === 'string') {\n                    const trimmedHref = hrefValue.trim();\n                    if (trimmedHref) {\n                        return `href:${trimmedHref}`;\n                    }\n                }\n            }\n\n            return FALLBACK_GROUP_ID;\n        };\n\n        const getTriggerLinks = (shouldUpdateDebug = true) => {\n            const links = Array.from(contentArea.querySelectorAll('a')).filter(a => a.querySelector('img'));\n            const grouped = links.reduce((accumulator, link) => {\n                const groupId = resolveLinkGroupId(link);\n                if (!accumulator[groupId]) {\n                    accumulator[groupId] = [];\n                }\n                accumulator[groupId].push(link);\n                return accumulator;\n            }, {});\n\n            if (shouldUpdateDebug) {\n                const groupCount = Object.keys(grouped).length;\n                const summary = `${links.length} (${groupCount} groupe${groupCount > 1 ? 's' : ''} apr\u00E8s filtrage)`;\n                debug.updateInfo('mga-debug-trigger-img', summary);\n            }\n\n            return grouped;\n        };\n\n        const sharedHelpers = {\n            resolveLinkGroupId,\n            isExplicitFallbackAllowed,\n            sanitizeHighResUrl,\n            sanitizeThumbnailUrl,\n            resolveThumbnailUrl,\n            getImageDataAttributes,\n        };\n\n        if (typeof module !== 'undefined' && module.exports) {\n            module.exports.helpers = sharedHelpers;\n        }\n\n        const historyManager = (() => {\n            const hasHistorySupport = typeof window !== 'undefined'\n                && window.history\n                && typeof window.history.pushState === 'function'\n                && typeof window.history.replaceState === 'function';\n\n            if (!hasHistorySupport) {\n                return {\n                    isSupported: false,\n                    isActive: () => false,\n                    getGalleryId: () => null,\n                    getLastIndex: () => 0,\n                    push: () => false,\n                    update: () => {},\n                    beginClose: () => false,\n                    finalizeClose: () => {},\n                    adoptExistingState: () => {},\n                };\n            }\n\n            let active = false;\n            let galleryId = null;\n            let lastIndex = 0;\n            let restoring = false;\n            let originalUrl = null;\n            let originalState = null;\n\n            const buildViewerUrl = (targetGalleryId, index) => {\n                try {\n                    const currentUrl = new URL(window.location.href);\n                    const encodedGalleryId = encodeURIComponent(targetGalleryId || '');\n                    const slideNumber = Math.max(1, (parseInt(index, 10) || 0) + 1);\n                    currentUrl.searchParams.set('mga', `${encodedGalleryId}:${slideNumber}`);\n                    return currentUrl.toString();\n                } catch (error) {\n                    return null;\n                }\n            };\n\n            const createState = (targetGalleryId, index) => ({\n                mgaViewer: {\n                    galleryId: targetGalleryId,\n                    index,\n                    returnUrl: originalUrl || window.location.href,\n                },\n            });\n\n            return {\n                isSupported: true,\n                isActive: () => active,\n                getGalleryId: () => galleryId,\n                getLastIndex: () => lastIndex,\n                push: (targetGalleryId, index, options = {}) => {\n                    const resolvedOriginalUrl = typeof options.originalUrl === 'string'\n                        ? options.originalUrl\n                        : window.location.href;\n                    const resolvedOriginalState = Object.prototype.hasOwnProperty.call(options, 'originalState')\n                        ? options.originalState\n                        : window.history.state;\n\n                    if (options.replaceOriginal && resolvedOriginalUrl) {\n                        try {\n                            window.history.replaceState(resolvedOriginalState, '', resolvedOriginalUrl);\n                        } catch (error) {\n                            // Ignor\u00E9 : si replaceState \u00E9choue, on continue avec l'URL actuelle.\n                        }\n                    }\n\n                    const viewerUrl = buildViewerUrl(targetGalleryId, index);\n                    if (!viewerUrl) {\n                        return false;\n                    }\n\n                    try {\n                        originalUrl = resolvedOriginalUrl;\n                        originalState = resolvedOriginalState;\n                        window.history.pushState(createState(targetGalleryId, index), '', viewerUrl);\n                        active = true;\n                        restoring = false;\n                        galleryId = targetGalleryId;\n                        lastIndex = index;\n                        return true;\n                    } catch (error) {\n                        return false;\n                    }\n                },\n                update: (index) => {\n                    if (!active) {\n                        return;\n                    }\n\n                    const viewerUrl = buildViewerUrl(galleryId, index);\n                    if (!viewerUrl) {\n                        return;\n                    }\n\n                    lastIndex = index;\n\n                    try {\n                        window.history.replaceState(createState(galleryId, index), '', viewerUrl);\n                    } catch (error) {\n                        // Ignor\u00E9 si replaceState \u00E9choue.\n                    }\n                },\n                beginClose: () => {\n                    if (!active) {\n                        return false;\n                    }\n\n                    restoring = true;\n                    try {\n                        window.history.back();\n                        return true;\n                    } catch (error) {\n                        restoring = false;\n                        return false;\n                    }\n                },\n                finalizeClose: () => {\n                    active = false;\n                    galleryId = null;\n                    lastIndex = 0;\n                    restoring = false;\n                    originalUrl = null;\n                    originalState = null;\n                },\n                adoptExistingState: (targetGalleryId, index, options = {}) => {\n                    active = true;\n                    galleryId = targetGalleryId;\n                    lastIndex = index;\n                    restoring = false;\n                    if (typeof options.originalUrl === 'string') {\n                        originalUrl = options.originalUrl;\n                    } else if (!originalUrl) {\n                        originalUrl = window.location.href;\n                    }\n                    if (Object.prototype.hasOwnProperty.call(options, 'originalState')) {\n                        originalState = options.originalState;\n                    }\n                },\n            };\n        })();\n\n        const { cleanup: triggerObserverCleanup, active: hasActiveObserver } = (() => {\n            if (typeof MutationObserver !== 'function') {\n                return { cleanup: noop, active: false };\n            }\n\n            if (!debug.enabled) {\n                return { cleanup: noop, active: false };\n            }\n\n            const observer = new MutationObserver(() => {\n                getTriggerLinks();\n            });\n\n            observer.observe(contentArea, { childList: true, subtree: true });\n\n            return {\n                cleanup: () => observer.disconnect(),\n                active: true,\n            };\n        })();\n\n        getTriggerLinks();\n\n        if (pendingDeepLink && pendingDeepLink.galleryId) {\n            setTimeout(() => {\n                const groupedLinks = getTriggerLinks(false);\n                const triggerLinks = groupedLinks[pendingDeepLink.galleryId] || [];\n                const galleryData = buildGalleryDataFromLinks(triggerLinks);\n\n                if (galleryData.length) {\n                    openViewerWithData(pendingDeepLink.galleryId, galleryData, pendingDeepLink.index, {\n                        skipFocusCapture: true,\n                        history: {\n                            action: 'push',\n                            replaceOriginal: true,\n                            originalUrl: pendingDeepLink.originalUrl,\n                            originalState: pendingDeepLink.originalState,\n                        },\n                    });\n                }\n\n                pendingDeepLink = null;\n            }, 0);\n        }\n\n        if (hasActiveObserver) {\n            window.addEventListener('beforeunload', triggerObserverCleanup);\n        }\n\n        debug.onForceOpen(() => {\n            debug.log(mga__( \"Clic sur 'Forcer l'ouverture'.\", 'lightbox-jlg' ));\n            const testImages = [\n                {\n                    highResUrl: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20800%20600%22%3E%3Crect%20width%3D%22800%22%20height%3D%22600%22%20fill%3D%22%230073aa%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-size%3D%2248%22%20fill%3D%22%23ffffff%22%3EImage%20Test%201%3C%2Ftext%3E%3C%2Fsvg%3E',\n                    thumbUrl: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20150%20150%22%3E%3Crect%20width%3D%22150%22%20height%3D%22150%22%20fill%3D%22%230073aa%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-size%3D%2218%22%20fill%3D%22%23ffffff%22%3EThumb%201%3C%2Ftext%3E%3C%2Fsvg%3E',\n                    caption: mga__( 'Ceci est la premi\u00E8re image de test.', 'lightbox-jlg' ),\n                },\n                {\n                    highResUrl: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20800%20600%22%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22grad%22%20x1%3D%220%25%22%20y1%3D%220%25%22%20x2%3D%22100%25%22%20y2%3D%22100%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23f44336%22%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23ff9800%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect%20width%3D%22800%22%20height%3D%22600%22%20fill%3D%22url(%23grad)%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-size%3D%2248%22%20fill%3D%22%23ffffff%22%3EImage%20Test%202%3C%2Ftext%3E%3C%2Fsvg%3E',\n                    thumbUrl: 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20150%20150%22%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22gradThumb%22%20x1%3D%220%25%22%20y1%3D%220%25%22%20x2%3D%22100%25%22%20y2%3D%22100%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23f44336%22%2F%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23ff9800%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect%20width%3D%22150%22%20height%3D%22150%22%20fill%3D%22url(%23gradThumb)%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20dominant-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20font-size%3D%2218%22%20fill%3D%22%23ffffff%22%3EThumb%202%3C%2Ftext%3E%3C%2Fsvg%3E',\n                    caption: mga__( 'Ceci est la seconde image de test.', 'lightbox-jlg' ),\n                },\n            ];\n            const previouslyFocusedElement = document.activeElement instanceof Element ? document.activeElement : null;\n            const viewerOpened = openViewerWithData('__debug__', testImages, 0, {\n                focusOrigin: previouslyFocusedElement || null,\n                history: { action: 'push' },\n            });\n            if (!viewerOpened) {\n                lastFocusedElementBeforeViewer = null;\n            }\n        });\n\n        contentArea.addEventListener('click', function (e) {\n            if (e.defaultPrevented) {\n                return;\n            }\n\n            if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) {\n                return;\n            }\n\n            const eventTarget = resolveEventTarget(e);\n            if (!eventTarget) {\n                return;\n            }\n\n            const targetLink = eventTarget.closest('a');\n            if (!targetLink) {\n                return;\n            }\n\n            if (targetLink.hasAttribute('download')) {\n                return;\n            }\n\n            if (targetLink.querySelector('img')) {\n                debug.log(mga__( 'Clic sur un lien contenant une image.', 'lightbox-jlg' ));\n\n                const clickedHighResUrl = getHighResUrl(targetLink);\n                if (!clickedHighResUrl) {\n                    debug.log(mga__( \"URL haute r\u00E9solution introuvable pour le lien cliqu\u00E9.\", 'lightbox-jlg' ));\n                    return;\n                }\n\n                const groupedTriggerLinks = getTriggerLinks();\n                const clickedGroupId = resolveLinkGroupId(targetLink);\n                const triggerLinks = groupedTriggerLinks[clickedGroupId] || [];\n\n                debug.log(mgaSprintf(\n                    mga__( 'Pr\u00E9paration de la galerie pour le groupe %s.', 'lightbox-jlg' ),\n                    clickedGroupId,\n                ));\n\n                const clickedTriggerIndex = triggerLinks.indexOf(targetLink);\n                if (clickedTriggerIndex === -1) {\n                    debug.log(mga__( \"ERREUR\u00A0: Lien d\u00E9clencheur introuvable dans la collection actuelle.\", 'lightbox-jlg' ), true);\n                    return;\n                }\n\n                const galleryData = buildGalleryDataFromLinks(triggerLinks);\n\n                debug.log(mgaSprintf(mga__( '%d images valides pr\u00E9par\u00E9es pour la galerie.', 'lightbox-jlg' ), galleryData.length));\n                debug.table(galleryData);\n\n                if (!galleryData.length) {\n                    debug.log(mga__( 'ERREUR\u00A0: Aucune image valide d\u00E9tect\u00E9e pour cette galerie.', 'lightbox-jlg' ), true);\n                    return;\n                }\n\n                const clickedImageIndex = galleryData.findIndex(img => img.triggerIndex === clickedTriggerIndex);\n\n                if (clickedImageIndex === -1) {\n                    debug.log(mga__( \"ERREUR : L'image cliqu\u00E9e n'a pas \u00E9t\u00E9 trouv\u00E9e dans la galerie construite.\", 'lightbox-jlg' ), true);\n                    debug.log(mgaSprintf(mga__( 'URL cliqu\u00E9e recherch\u00E9e\u00A0: %s', 'lightbox-jlg' ), clickedHighResUrl), true);\n                }\n\n                const startIndex = startOnClickedImage && clickedImageIndex !== -1 ? clickedImageIndex : 0;\n\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(\n                        mgaSprintf(\n                            mga__( 'Index initial demand\u00E9 via clic\u00A0: %1$d (option active\u00A0: %2$s, trouv\u00E9\u00A0: %3$d).', 'lightbox-jlg' ),\n                            startIndex,\n                            startOnClickedImage ? mga__( 'oui', 'lightbox-jlg' ) : mga__( 'non', 'lightbox-jlg' ),\n                            clickedImageIndex\n                        )\n                    );\n                }\n\n                const previouslyFocusedElement = document.activeElement instanceof Element\n                    ? document.activeElement\n                    : null;\n\n                const viewerOpened = openViewerWithData(clickedGroupId, galleryData, startIndex, {\n                    focusOrigin: previouslyFocusedElement || null,\n                    history: { action: 'push' },\n                });\n                if (viewerOpened) {\n                    e.preventDefault();\n                } else {\n                    lastFocusedElementBeforeViewer = null;\n                }\n            }\n        });\n\n        const handleHistoryPop = (event) => {\n            if (!historyManager.isSupported) {\n                return;\n            }\n\n            const state = event && typeof event.state === 'object' && event.state !== null\n                ? event.state\n                : null;\n            const viewerState = state && typeof state.mgaViewer === 'object' ? state.mgaViewer : null;\n            const viewer = getViewer();\n\n            if (viewerState && viewerState.galleryId) {\n                const targetGalleryId = viewerState.galleryId;\n                const targetIndex = Number.isFinite(viewerState.index) ? viewerState.index : 0;\n                const returnUrl = typeof viewerState.returnUrl === 'string' ? viewerState.returnUrl : undefined;\n                const groupedLinks = getTriggerLinks(false);\n                const triggerLinks = groupedLinks[targetGalleryId] || [];\n                const galleryData = buildGalleryDataFromLinks(triggerLinks);\n\n                if (!galleryData.length) {\n                    if (viewer && viewer.style.display !== 'none') {\n                        closeViewer(viewer, { skipHistory: true });\n                    }\n                    return;\n                }\n\n                const historyPayload = {\n                    originalUrl: returnUrl,\n                    originalState: state,\n                };\n\n                if (viewer && viewer.style.display !== 'none') {\n                    if (currentGalleryId !== targetGalleryId) {\n                        closeViewer(viewer, { skipHistory: true });\n                        openViewerWithData(targetGalleryId, galleryData, targetIndex, {\n                            skipFocusCapture: true,\n                            history: Object.assign({ action: 'sync' }, historyPayload),\n                        });\n                    } else {\n                        historyManager.adoptExistingState(targetGalleryId, targetIndex, historyPayload);\n                        const clampedIndex = Math.max(0, Math.min(targetIndex, galleryData.length - 1));\n                        currentGalleryImages = galleryData;\n                        currentGalleryId = targetGalleryId;\n                        if (mainSwiper && !mainSwiper.destroyed) {\n                            slideToIndex(mainSwiper, clampedIndex, 0);\n                        }\n                        updateInfo(viewer, galleryData, clampedIndex);\n                    }\n                } else {\n                    openViewerWithData(targetGalleryId, galleryData, targetIndex, {\n                        skipFocusCapture: true,\n                        history: Object.assign({ action: 'sync' }, historyPayload),\n                    });\n                }\n\n                return;\n            }\n\n            if (historyManager.isActive && historyManager.isActive()) {\n                const activeViewer = getViewer();\n                if (activeViewer && activeViewer.style.display !== 'none') {\n                    closeViewer(activeViewer, { skipHistory: true });\n                }\n            }\n        };\n\n        function openViewer(images, startIndex, options = {}) {\n            debug.log(mgaSprintf(mga__( 'openViewer appel\u00E9 avec %1$d images, index %2$d.', 'lightbox-jlg' ), images.length, startIndex));\n            if (debug && typeof debug.restartTimer === 'function') {\n                debug.restartTimer();\n            }\n            const viewer = getViewer();\n            if (!viewer) return false;\n\n            const parsedStartIndex = parseInt(startIndex, 10);\n            const normalizedStartIndex = Number.isFinite(parsedStartIndex) ? parsedStartIndex : 0;\n            const sanitizedStartIndex = Math.min(\n                Math.max(normalizedStartIndex, 0),\n                Math.max(images.length - 1, 0),\n            );\n            const galleryId = typeof options.galleryId === 'string' ? options.galleryId : null;\n            const historyOptionsRaw = options && typeof options.history === 'object' && options.history !== null\n                ? options.history\n                : {};\n            const historyAction = typeof historyOptionsRaw.action === 'string' ? historyOptionsRaw.action : 'push';\n            const historyPayload = {\n                originalUrl: historyOptionsRaw.originalUrl,\n                originalState: historyOptionsRaw.originalState,\n                replaceOriginal: historyOptionsRaw.replaceOriginal,\n            };\n\n            viewer.className = 'mga-viewer mga-viewer--compact';\n            viewer.classList.toggle('mga-has-caption', false);\n            if (thumbsLayout === 'left') {\n                viewer.classList.add('mga-thumbs-left');\n            } else if (thumbsLayout === 'hidden') {\n                viewer.classList.add('mga-thumbs-hidden');\n            }\n            if (settings.background_style === 'blur') viewer.classList.add('mga-has-blur');\n            if (settings.background_style === 'texture') viewer.classList.add('mga-has-texture');\n            if (!showThumbsMobile) {\n                viewer.classList.add('mga-hide-thumbs-mobile');\n            }\n\n            try {\n                if (mainSwiper) {\n                    mainSwiper.destroy(true, true);\n                }\n                if (thumbsSwiper) {\n                    thumbsSwiper.destroy(true, true);\n                }\n                mainSwiper = null;\n                thumbsSwiper = null;\n                preloadedUrls.clear();\n\n                const mainWrapper = viewer.querySelector('#mga-main-wrapper');\n                const thumbsWrapper = viewer.querySelector('#mga-thumbs-wrapper');\n                mainWrapper.textContent = '';\n                if (thumbsWrapper) {\n                    thumbsWrapper.textContent = '';\n                }\n\n                const thumbButtons = [];\n                const updateThumbFocusState = (activeIndex) => {\n                    if (!thumbButtons.length) {\n                        return;\n                    }\n\n                    let activeFound = false;\n\n                    thumbButtons.forEach((button) => {\n                        const buttonIndex = parseInt(button.getAttribute('data-slide-index'), 10);\n                        const isActive = Number.isFinite(buttonIndex) && buttonIndex === activeIndex;\n\n                        if (isActive) {\n                            button.setAttribute('aria-current', 'true');\n                            button.setAttribute('tabindex', '0');\n                            activeFound = true;\n                        } else {\n                            button.removeAttribute('aria-current');\n                            button.setAttribute('tabindex', '-1');\n                        }\n                    });\n\n                    if (!activeFound) {\n                        const firstButton = thumbButtons[0];\n                        if (firstButton) {\n                            firstButton.setAttribute('tabindex', '0');\n                        }\n                    }\n                };\n\n                const createThumbAriaLabel = (image, position) => {\n                    if (image && image.caption) {\n                        return mgaSprintf(\n                            mga__( 'Afficher la diapositive %s\u00A0: %s', 'lightbox-jlg' ),\n                            String(position),\n                            image.caption\n                        );\n                    }\n\n                    return mgaSprintf(\n                        mga__( 'Afficher la diapositive %s', 'lightbox-jlg' ),\n                        String(position)\n                    );\n                };\n\n                function handleThumbNavigation(targetIndex) {\n                    if (mainSwiper && !mainSwiper.destroyed) {\n                        slideToIndex(mainSwiper, targetIndex);\n                    }\n\n                    if (thumbsSwiper && !thumbsSwiper.destroyed && typeof thumbsSwiper.slideTo === 'function') {\n                        thumbsSwiper.slideTo(targetIndex);\n                    }\n                    updateThumbFocusState(targetIndex);\n                }\n\n                images.forEach((img, index) => {\n                    const slide = document.createElement('div');\n                    slide.className = 'swiper-slide';\n                    slide.setAttribute('data-slide-index', index);\n\n                    const spinner = document.createElement('div');\n                    spinner.className = 'mga-spinner';\n                    spinner.style.display = 'none';\n                    slide.appendChild(spinner);\n\n                    const zoomContainer = document.createElement('div');\n                    zoomContainer.className = 'swiper-zoom-container';\n\n                    const mainImg = document.createElement('img');\n                    mainImg.setAttribute('loading', 'lazy');\n                    mainImg.setAttribute('src', img.highResUrl);\n                    mainImg.setAttribute('alt', img.caption);\n                    zoomContainer.appendChild(mainImg);\n\n                    slide.appendChild(zoomContainer);\n                    mainWrapper.appendChild(slide);\n\n                    if (thumbsWrapper) {\n                        const thumbSlide = document.createElement('div');\n                        thumbSlide.className = 'swiper-slide';\n\n                        const thumbButton = document.createElement('button');\n                        thumbButton.type = 'button';\n                        thumbButton.className = 'mga-thumb-button';\n                        thumbButton.setAttribute('data-slide-index', String(index));\n                        thumbButton.setAttribute('aria-label', createThumbAriaLabel(img, index + 1));\n                        thumbButton.setAttribute('tabindex', index === sanitizedStartIndex ? '0' : '-1');\n\n                        const thumbImg = document.createElement('img');\n                        thumbImg.setAttribute('loading', 'lazy');\n                        thumbImg.setAttribute('src', img.thumbUrl);\n                        thumbImg.setAttribute('alt', img.caption);\n                        thumbButton.appendChild(thumbImg);\n\n                        const activateThumb = (event) => {\n                            if (event) {\n                                event.preventDefault();\n                            }\n                            handleThumbNavigation(index);\n                        };\n\n                        thumbButton.addEventListener('click', activateThumb);\n\n                        thumbButton.addEventListener('keydown', (event) => {\n                            const { key } = event;\n                            const navigationKeys = ['ArrowLeft', 'ArrowUp', 'ArrowRight', 'ArrowDown', 'Home', 'End'];\n\n                            if (!navigationKeys.includes(key)) {\n                                return;\n                            }\n\n                            event.preventDefault();\n\n                            if (!thumbButtons.length) {\n                                return;\n                            }\n\n                            let targetIndex = index;\n\n                            if ('Home' === key) {\n                                targetIndex = 0;\n                            } else if ('End' === key) {\n                                targetIndex = thumbButtons.length - 1;\n                            } else if ('ArrowLeft' === key || 'ArrowUp' === key) {\n                                targetIndex = index - 1;\n                            } else if ('ArrowRight' === key || 'ArrowDown' === key) {\n                                targetIndex = index + 1;\n                            }\n\n                            if (targetIndex < 0) {\n                                targetIndex = thumbButtons.length - 1;\n                            } else if (targetIndex >= thumbButtons.length) {\n                                targetIndex = 0;\n                            }\n\n                            const targetButton = thumbButtons[targetIndex];\n\n                            if (targetButton) {\n                                targetButton.focus();\n                                handleThumbNavigation(targetIndex);\n                            }\n                        });\n\n                        thumbButtons.push(thumbButton);\n\n                        thumbSlide.appendChild(thumbButton);\n\n                        thumbsWrapper.appendChild(thumbSlide);\n                    }\n                });\n                debug.log(mga__( 'Wrappers HTML remplis avec URLs optimis\u00E9es.', 'lightbox-jlg' ));\n\n                if (thumbButtons.length) {\n                    thumbAccessibilityUpdater = updateThumbFocusState;\n                    updateThumbFocusState(sanitizedStartIndex);\n                } else {\n                    thumbAccessibilityUpdater = null;\n                }\n\n                initSwiper(viewer, images, sanitizedStartIndex);\n                if (!mainSwiper) {\n                    const cancelMessage = mga__( 'Visionneuse annul\u00E9e\u00A0: Swiper n\u2019a pas pu \u00EAtre initialis\u00E9.', 'lightbox-jlg' );\n                    if (debug && typeof debug.log === 'function') {\n                        debug.log(cancelMessage, true);\n                    } else if (typeof console !== 'undefined' && typeof console.error === 'function') {\n                        console.error(cancelMessage);\n                    }\n                    viewer.style.display = 'none';\n                    return false;\n                }\n\n                currentGalleryImages = Array.isArray(images) ? images : [];\n                currentGalleryId = galleryId;\n\n                const finalizeInitialState = () => {\n                    if (!mainSwiper || mainSwiper.destroyed) {\n                        return;\n                    }\n\n                    slideToIndex(mainSwiper, sanitizedStartIndex, 0);\n\n                    if (thumbsSwiper && typeof thumbsSwiper.slideTo === 'function') {\n                        thumbsSwiper.slideTo(sanitizedStartIndex);\n                    }\n\n                    if (\n                        settings.background_style === 'echo' &&\n                        images[sanitizedStartIndex] &&\n                        images[sanitizedStartIndex].highResUrl\n                    ) {\n                        updateEchoBackground(viewer, images[sanitizedStartIndex].highResUrl);\n                    }\n\n                    updateInfo(viewer, images, sanitizedStartIndex);\n                };\n\n                const requiresVisibleContainerForInitialSlide = Boolean(\n                    mainSwiper &&\n                    mainSwiper.params &&\n                    mainSwiper.params.cssMode\n                );\n\n                if (requiresVisibleContainerForInitialSlide) {\n                    viewer.style.display = 'flex';\n                    const schedule = (typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function')\n                        ? window.requestAnimationFrame.bind(window)\n                        : (callback) => setTimeout(callback, 0);\n\n                    schedule(() => {\n                        finalizeInitialState();\n                    });\n                } else {\n                    finalizeInitialState();\n                    viewer.style.display = 'flex';\n                }\n                if (historyManager.isSupported) {\n                    if (historyAction === 'sync') {\n                        historyManager.adoptExistingState(galleryId, sanitizedStartIndex, historyPayload);\n                        if (historyManager.isActive && historyManager.isActive()) {\n                            historyManager.update(sanitizedStartIndex);\n                        }\n                    } else if (historyAction === 'none') {\n                        historyManager.adoptExistingState(galleryId, sanitizedStartIndex, historyPayload);\n                    } else {\n                        const pushed = historyManager.push(galleryId, sanitizedStartIndex, historyPayload);\n                        if (!pushed && typeof historyManager.adoptExistingState === 'function') {\n                            historyManager.adoptExistingState(galleryId, sanitizedStartIndex, historyPayload);\n                        }\n                        if (historyManager.isActive && historyManager.isActive()) {\n                            historyManager.update(sanitizedStartIndex);\n                        }\n                    }\n                }\n                if (!lastFocusedElementBeforeViewer) {\n                    lastFocusedElementBeforeViewer = document.activeElement;\n                }\n                setupViewerFocusManagement(viewer);\n                const previousOverflow = document.body.style.overflow;\n                const previousPaddingRight = document.body.style.paddingRight;\n                initialBodyOverflow = previousOverflow;\n                initialBodyPaddingRight = previousPaddingRight;\n\n                let computedPaddingRight = 0;\n                if (typeof window !== 'undefined' && typeof window.getComputedStyle === 'function') {\n                    const bodyComputedStyle = window.getComputedStyle(document.body);\n                    computedPaddingRight = parseFloat(bodyComputedStyle.paddingRight) || 0;\n                } else if (previousPaddingRight) {\n                    const parsedPadding = parseFloat(previousPaddingRight);\n                    computedPaddingRight = Number.isNaN(parsedPadding) ? 0 : parsedPadding;\n                }\n\n                const scrollbarWidth = (typeof window !== 'undefined' && typeof window.innerWidth === 'number' && typeof document !== 'undefined' && document.documentElement)\n                    ? Math.max(window.innerWidth - document.documentElement.clientWidth, 0)\n                    : 0;\n\n                if (scrollbarWidth > 0) {\n                    document.body.style.paddingRight = `${computedPaddingRight + scrollbarWidth}px`;\n                    bodyPaddingRightWasModified = true;\n                } else {\n                    bodyPaddingRightWasModified = false;\n                }\n\n                if (document.body.classList.contains(SCROLL_LOCK_CLASS)) {\n                    bodyScrollLockClassAdded = false;\n                } else {\n                    document.body.classList.add(SCROLL_LOCK_CLASS);\n                    bodyScrollLockClassAdded = true;\n                }\n\n                if (previousOverflow !== 'hidden') {\n                    document.body.style.overflow = 'hidden';\n                    bodyOverflowWasModified = true;\n                } else {\n                    bodyOverflowWasModified = false;\n                }\n                debug.log(mga__( 'Galerie affich\u00E9e avec succ\u00E8s.', 'lightbox-jlg' ));\n                if (!isResizeListenerAttached) {\n                    window.addEventListener('resize', handleResize);\n                    isResizeListenerAttached = true;\n                }\n                return true;\n            } catch (error) {\n                debug.log(mgaSprintf(mga__( 'ERREUR dans openViewer\u00A0: %s', 'lightbox-jlg' ), error.message), true);\n                console.error(error);\n                viewer.style.display = 'none';\n                return false;\n            }\n        }\n\n        function getFocusableViewerElements(viewer) {\n            const selectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])';\n            return Array.from(viewer.querySelectorAll(selectors)).filter(element => {\n                if (element.disabled) return false;\n                if (element.getAttribute('aria-hidden') === 'true') return false;\n                const rect = element.getBoundingClientRect();\n                return !!(rect.width || rect.height || element.getClientRects().length);\n            });\n        }\n\n        function setupViewerFocusManagement(viewer) {\n            if (!viewer.hasAttribute('tabindex')) {\n                viewer.setAttribute('tabindex', '-1');\n            }\n\n            if (viewerFocusTrapHandler) {\n                viewer.removeEventListener('keydown', viewerFocusTrapHandler, true);\n            }\n\n            viewerFocusTrapHandler = function(e) {\n                if (e.key !== 'Tab') return;\n\n                const focusable = getFocusableViewerElements(viewer);\n\n                if (!focusable.length) {\n                    e.preventDefault();\n                    safeFocus(viewer);\n                    return;\n                }\n\n                const currentIndex = focusable.indexOf(document.activeElement);\n                let nextIndex = currentIndex;\n\n                if (e.shiftKey) {\n                    if (currentIndex <= 0) {\n                        nextIndex = focusable.length - 1;\n                    } else {\n                        nextIndex = currentIndex - 1;\n                    }\n                } else {\n                    if (currentIndex === -1 || currentIndex === focusable.length - 1) {\n                        nextIndex = 0;\n                    } else {\n                        nextIndex = currentIndex + 1;\n                    }\n                }\n\n                e.preventDefault();\n                safeFocus(focusable[nextIndex]);\n            };\n\n            viewer.addEventListener('keydown', viewerFocusTrapHandler, true);\n\n            const closeButton = viewer.querySelector('#mga-close');\n            const target = closeButton && closeButton.offsetParent !== null ? closeButton : viewer;\n            if (target && typeof target.focus === 'function') {\n                safeFocus(target);\n            }\n        }\n\n        function initSwiper(viewer, images, startIndex = 0) {\n            if (typeof cleanupAutoplayPreferenceListener === 'function') {\n                cleanupAutoplayPreferenceListener();\n                cleanupAutoplayPreferenceListener = null;\n            }\n            autoplayWasRunningBeforePreferenceChange = false;\n\n            const sanitizedEffect = sanitizeEffect(settings.effect);\n            const sanitizedSpeed = sanitizeSpeed(settings.speed);\n            const sanitizedEasing = sanitizeEasing(settings.easing);\n\n            const mainSwiperContainer = viewer.querySelector('.mga-main-swiper');\n            const thumbsSwiperContainer = thumbsLayout === 'hidden'\n                ? null\n                : viewer.querySelector('.mga-thumbs-swiper');\n\n            if (thumbsSwiperContainer) {\n                const thumbsConfig = {\n                    spaceBetween: 10,\n                    slidesPerView: 'auto',\n                    freeMode: true,\n                    watchSlidesProgress: true,\n                    passiveListeners: true,\n                };\n\n                if (thumbsLayout === 'left') {\n                    thumbsConfig.direction = 'vertical';\n                    thumbsConfig.breakpoints = {\n                        0: { direction: 'horizontal' },\n                        769: { direction: 'vertical' },\n                    };\n                }\n\n                thumbsSwiper = createSwiperInstance(thumbsSwiperContainer, thumbsConfig);\n\n                if (thumbsSwiper) {\n                    applyTransitionEasing(thumbsSwiper, sanitizedEasing);\n                }\n            } else {\n                thumbsSwiper = null;\n            }\n\n            if (!thumbsSwiper && thumbsLayout !== 'hidden') {\n                const thumbsMessage = mga__( 'Initialisation des miniatures Swiper impossible. La visionneuse fonctionnera sans elles.', 'lightbox-jlg' );\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(thumbsMessage, true);\n                } else if (typeof console !== 'undefined' && typeof console.error === 'function') {\n                    console.error(thumbsMessage);\n                }\n            }\n\n            // L'instance principale peut activer `loop` en fonction des r\u00E9glages.\n            // On passe par le wrapper pour att\u00E9nuer l'avertissement Swiper localement.\n            const autoplayConfig = {\n                delay: parseInt(settings.delay, 10) * 1000 || 4000,\n                disableOnInteraction: false,\n                pauseOnMouseEnter: false,\n            };\n\n            const prefersReducedMotionQuery = (typeof window !== 'undefined' && typeof window.matchMedia === 'function')\n                ? window.matchMedia('(prefers-reduced-motion: reduce)')\n                : null;\n\n            const prefersReducedMotion = !!(prefersReducedMotionQuery && prefersReducedMotionQuery.matches);\n\n            if (debug && typeof debug.log === 'function') {\n                if (prefersReducedMotionQuery) {\n                    debug.log(\n                        mgaSprintf(\n                            mga__( 'Pr\u00E9f\u00E9rence de r\u00E9duction des animations d\u00E9tect\u00E9e\u00A0: %s.', 'lightbox-jlg' ),\n                            prefersReducedMotion ? mga__( 'oui', 'lightbox-jlg' ) : mga__( 'non', 'lightbox-jlg' )\n                        )\n                    );\n                } else {\n                    debug.log(mga__( 'Impossible de d\u00E9terminer la pr\u00E9f\u00E9rence de r\u00E9duction des animations (matchMedia indisponible).', 'lightbox-jlg' ));\n                }\n            }\n\n            let resolvedEffect = sanitizedEffect;\n            let resolvedSpeed = sanitizedSpeed;\n            let enableCssMode = false;\n\n            if (prefersReducedMotion) {\n                enableCssMode = true;\n\n                if (HEAVY_EFFECTS.has(resolvedEffect)) {\n                    if (debug && typeof debug.log === 'function') {\n                        debug.log(mga__( 'Effet 3D d\u00E9sactiv\u00E9 pour respecter la pr\u00E9f\u00E9rence de r\u00E9duction des animations.', 'lightbox-jlg' ));\n                    }\n                    resolvedEffect = DEFAULT_EFFECT;\n                }\n\n                resolvedSpeed = Math.min(resolvedSpeed, 300);\n            }\n\n            const shouldUseCssMode = enableCssMode && resolvedEffect === 'slide' && !loopEnabled;\n\n            if (debug && typeof debug.log === 'function') {\n                debug.log(\n                    mgaSprintf(\n                        mga__( 'Effet retenu\u00A0: %1$s (vitesse\u00A0: %2$ims).', 'lightbox-jlg' ),\n                        resolvedEffect,\n                        resolvedSpeed\n                    )\n                );\n\n                if (shouldUseCssMode) {\n                    debug.log(mga__( 'Mode CSS activ\u00E9 pour limiter les animations.', 'lightbox-jlg' ));\n                } else if (enableCssMode && resolvedEffect === 'slide' && loopEnabled) {\n                    debug.log(mga__( 'Mode CSS non activ\u00E9 car incompatible avec le mode boucle.', 'lightbox-jlg' ));\n                }\n            }\n\n            const sanitizedInitialSlide = Math.min(\n                Math.max(parseInt(startIndex, 10) || 0, 0),\n                Math.max(images.length - 1, 0)\n            );\n\n            if (debug && typeof debug.log === 'function') {\n                debug.log(\n                    mgaSprintf(\n                        mga__( 'Index initial normalis\u00E9\u00A0: %1$d (boucle\u00A0: %2$s, CSS mode\u00A0: %3$s).', 'lightbox-jlg' ),\n                        sanitizedInitialSlide,\n                        loopEnabled ? mga__( 'oui', 'lightbox-jlg' ) : mga__( 'non', 'lightbox-jlg' ),\n                        shouldUseCssMode ? mga__( 'oui', 'lightbox-jlg' ) : mga__( 'non', 'lightbox-jlg' )\n                    )\n                );\n            }\n\n            const handleAutoplayStart = () => {\n                debug.log(mga__( 'Autoplay D\u00C9MARR\u00C9.', 'lightbox-jlg' ));\n                viewer.querySelector('.mga-play-icon').style.display = 'none';\n                viewer.querySelector('.mga-pause-icon').style.display = 'inline-block';\n                updateAutoplayButtonState(viewer, true);\n            };\n\n            const handleAutoplayStop = () => {\n                debug.log(mga__( 'Autoplay ARR\u00CAT\u00C9.', 'lightbox-jlg' ));\n                viewer.querySelector('.mga-play-icon').style.display = 'inline-block';\n                viewer.querySelector('.mga-pause-icon').style.display = 'none';\n                const progressCircle = viewer.querySelector('.mga-timer-progress');\n                if (progressCircle) {\n                    progressCircle.style.strokeDashoffset = 100;\n                }\n                debug.updateInfo('mga-debug-autoplay-time', mga__( 'Stopp\u00E9', 'lightbox-jlg' ));\n                updateAutoplayButtonState(viewer, false);\n            };\n\n            const mainSwiperConfig = {\n                zoom: showZoom,\n                spaceBetween: 10,\n                loop: loopEnabled,\n                effect: resolvedEffect,\n                speed: resolvedSpeed,\n                cssMode: shouldUseCssMode,\n                initialSlide: sanitizedInitialSlide,\n                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },\n                on: {\n                    init: function(swiper) {\n                        preloadNeighboringImages(images, swiper.realIndex);\n                        if (typeof thumbAccessibilityUpdater === 'function') {\n                            thumbAccessibilityUpdater(swiper.realIndex);\n                        }\n                    },\n                    slideChange: function (swiper) {\n                        updateInfo(viewer, images, swiper.realIndex);\n                        if (settings.background_style === 'echo') updateEchoBackground(viewer, images[swiper.realIndex].highResUrl);\n                        if (typeof thumbAccessibilityUpdater === 'function') {\n                            thumbAccessibilityUpdater(swiper.realIndex);\n                        }\n                    },\n                    slideChangeTransitionEnd: function() {\n                        if (thumbsSwiper && !thumbsSwiper.destroyed) {\n                           thumbsSwiper.update();\n                        }\n                        preloadNeighboringImages(images, this.realIndex);\n                    },\n                    autoplayTimeLeft(s, time, progress) {\n                        const progressCircle = viewer.querySelector('.mga-timer-progress');\n                        if (progressCircle) progressCircle.style.strokeDashoffset = 100 - (progress * 100);\n                        debug.updateInfo('mga-debug-autoplay-time', mgaSprintf(mga__( '%ss', 'lightbox-jlg' ), (time / 1000).toFixed(2)));\n                    },\n                    slideChangeTransitionStart: function(swiper) {\n                        const slide = swiper.slides[swiper.activeIndex];\n                        const img = slide.querySelector('img');\n                        if (img && !img.complete) {\n                            debug.log(mgaSprintf(mga__( \"Chargement de l'image %s...\", 'lightbox-jlg' ), slide.dataset.slideIndex));\n                            slide.querySelector('.mga-spinner').style.display = 'block';\n                            img.onload = () => {\n                                debug.log(mgaSprintf(mga__( 'Image %s charg\u00E9e.', 'lightbox-jlg' ), slide.dataset.slideIndex));\n                                slide.querySelector('.mga-spinner').style.display = 'none';\n                            };\n                        }\n                    },\n                    autoplayStart: handleAutoplayStart,\n                    autoplayStop: handleAutoplayStop,\n                    touchStart: () => { debug.log(mga__( 'Interaction manuelle D\u00C9TECT\u00C9E (touch).', 'lightbox-jlg' )); },\n                    sliderMove: () => { debug.log(mga__( 'Interaction manuelle D\u00C9TECT\u00C9E (drag).', 'lightbox-jlg' )); }\n                },\n            };\n\n            if (resolvedEffect === 'fade') {\n                mainSwiperConfig.fadeEffect = { crossFade: true };\n            }\n\n            if (!prefersReducedMotion) {\n                mainSwiperConfig.autoplay = Object.assign({}, autoplayConfig);\n            }\n\n            if (thumbsSwiper) {\n                mainSwiperConfig.thumbs = { swiper: thumbsSwiper };\n            }\n\n            const originalInitHandler = mainSwiperConfig.on.init;\n            mainSwiperConfig.on.init = function(swiper) {\n                if (typeof originalInitHandler === 'function') {\n                    originalInitHandler.call(this, swiper);\n                }\n                applyTransitionEasing(swiper, sanitizedEasing);\n            };\n\n            const originalSetTransition = mainSwiperConfig.on.setTransition;\n            mainSwiperConfig.on.setTransition = function(swiper) {\n                if (typeof originalSetTransition === 'function') {\n                    originalSetTransition.apply(this, arguments);\n                }\n                const targetSwiper = swiper && swiper.wrapperEl ? swiper : this;\n                applyTransitionEasing(targetSwiper, sanitizedEasing);\n            };\n\n            if (typeof module !== 'undefined' && module.exports) {\n                module.exports.__testExports = module.exports.__testExports || {};\n                module.exports.__testExports.getAutoplayHandlers = () => ({\n                    autoplayStart: handleAutoplayStart,\n                    autoplayStop: handleAutoplayStop,\n                });\n            }\n\n            mainSwiper = createSwiperInstance(mainSwiperContainer, mainSwiperConfig);\n\n            if (!mainSwiper) {\n                const mainMessage = mga__( 'Initialisation du Swiper principal impossible. Visionneuse indisponible.', 'lightbox-jlg' );\n                if (debug && typeof debug.log === 'function') {\n                    debug.log(mainMessage, true);\n                } else if (typeof console !== 'undefined' && typeof console.error === 'function') {\n                    console.error(mainMessage);\n                }\n                return;\n            }\n\n            applyTransitionEasing(mainSwiper, sanitizedEasing);\n\n            const emitSlidesVisibilityUpdate = () => {\n                const params = (mainSwiper && mainSwiper.params && typeof mainSwiper.params === 'object')\n                    ? mainSwiper.params\n                    : mainSwiperConfig;\n                reportSlidesVisibility(mainSwiper, params);\n            };\n\n            emitSlidesVisibilityUpdate();\n\n            if (mainSwiper && typeof mainSwiper.on === 'function') {\n                mainSwiper.on('resize', emitSlidesVisibilityUpdate);\n                mainSwiper.on('breakpoint', emitSlidesVisibilityUpdate);\n                mainSwiper.on('slidesLengthChange', emitSlidesVisibilityUpdate);\n            }\n\n            const autoplayInstance = mainSwiper.autoplay;\n            const hasAutoplayModule = !!(autoplayInstance && typeof autoplayInstance.start === 'function' && typeof autoplayInstance.stop === 'function');\n\n            const applyAutoplayParams = () => {\n                if (!mainSwiper || mainSwiper.destroyed) {\n                    return;\n                }\n\n                if (mainSwiper.params && typeof mainSwiper.params === 'object') {\n                    const paramsAutoplay = mainSwiper.params.autoplay && typeof mainSwiper.params.autoplay === 'object'\n                        ? mainSwiper.params.autoplay\n                        : (mainSwiper.params.autoplay = {});\n                    Object.assign(paramsAutoplay, autoplayConfig);\n                }\n\n                if (mainSwiper.originalParams && typeof mainSwiper.originalParams === 'object') {\n                    const originalAutoplay = mainSwiper.originalParams.autoplay && typeof mainSwiper.originalParams.autoplay === 'object'\n                        ? mainSwiper.originalParams.autoplay\n                        : (mainSwiper.originalParams.autoplay = {});\n                    Object.assign(originalAutoplay, autoplayConfig);\n                }\n            };\n\n            if (!hasAutoplayModule) {\n                if (!prefersReducedMotion) {\n                    debug.log(mga__( 'L\u2019extension autoplay de Swiper est indisponible.', 'lightbox-jlg' ), true);\n                }\n            } else {\n                if (!prefersReducedMotion) {\n                    applyAutoplayParams();\n                    if (settings.autoplay_start) {\n                        autoplayInstance.start();\n                    } else {\n                        autoplayInstance.stop();\n                    }\n                } else {\n                    autoplayInstance.stop();\n                }\n\n                if (prefersReducedMotionQuery) {\n                    const handleReducedMotionChange = (event) => {\n                        if (!mainSwiper || mainSwiper.destroyed) {\n                            return;\n                        }\n\n                        const instance = mainSwiper.autoplay;\n                        if (!instance || typeof instance.start !== 'function' || typeof instance.stop !== 'function') {\n                            return;\n                        }\n\n                        const matchesReducedMotion = !!event.matches;\n                        const targetEffect = matchesReducedMotion && HEAVY_EFFECTS.has(sanitizedEffect)\n                            ? DEFAULT_EFFECT\n                            : sanitizedEffect;\n                        const targetSpeed = matchesReducedMotion ? Math.min(sanitizedSpeed, 300) : sanitizedSpeed;\n                        const targetCssMode = matchesReducedMotion && targetEffect === 'slide';\n\n                        if (matchesReducedMotion) {\n                            autoplayWasRunningBeforePreferenceChange = Boolean(instance.running);\n                            instance.stop();\n                            if (targetEffect !== sanitizedEffect && debug && typeof debug.log === 'function') {\n                                debug.log(mga__( 'Effet de transition r\u00E9duit suite au changement de pr\u00E9f\u00E9rence syst\u00E8me.', 'lightbox-jlg' ));\n                            }\n                        } else {\n                            const shouldResume = autoplayWasRunningBeforePreferenceChange || !!settings.autoplay_start;\n                            autoplayWasRunningBeforePreferenceChange = false;\n                            applyAutoplayParams();\n                            if (targetEffect !== sanitizedEffect && debug && typeof debug.log === 'function') {\n                                debug.log(mga__( 'Effet de transition restaur\u00E9 apr\u00E8s d\u00E9sactivation de la r\u00E9duction des animations.', 'lightbox-jlg' ));\n                            }\n                            if (shouldResume) {\n                                instance.start();\n                            } else if (instance.running) {\n                                instance.stop();\n                            }\n                        }\n\n                        resolvedEffect = targetEffect;\n                        resolvedSpeed = targetSpeed;\n\n                        if (mainSwiper.params && typeof mainSwiper.params === 'object') {\n                            mainSwiper.params.effect = targetEffect;\n                            mainSwiper.params.speed = targetSpeed;\n                            mainSwiper.params.cssMode = targetCssMode;\n\n                            if (targetEffect === 'fade') {\n                                mainSwiper.params.fadeEffect = Object.assign({}, mainSwiper.params.fadeEffect || {}, { crossFade: true });\n                            } else if (mainSwiper.params.fadeEffect) {\n                                delete mainSwiper.params.fadeEffect;\n                            }\n                        }\n\n                        if (mainSwiper.originalParams && typeof mainSwiper.originalParams === 'object') {\n                            mainSwiper.originalParams.effect = targetEffect;\n                            mainSwiper.originalParams.speed = targetSpeed;\n                            mainSwiper.originalParams.cssMode = targetCssMode;\n\n                            if (targetEffect === 'fade') {\n                                mainSwiper.originalParams.fadeEffect = Object.assign({}, mainSwiper.originalParams.fadeEffect || {}, { crossFade: true });\n                            } else if (mainSwiper.originalParams.fadeEffect) {\n                                delete mainSwiper.originalParams.fadeEffect;\n                            }\n                        }\n\n                        applyTransitionEasing(mainSwiper, sanitizedEasing);\n                        if (thumbsSwiper && !thumbsSwiper.destroyed) {\n                            applyTransitionEasing(thumbsSwiper, sanitizedEasing);\n                        }\n\n                        if (typeof mainSwiper.update === 'function') {\n                            mainSwiper.update();\n                        }\n                    };\n\n                    if (typeof prefersReducedMotionQuery.addEventListener === 'function') {\n                        prefersReducedMotionQuery.addEventListener('change', handleReducedMotionChange);\n                        cleanupAutoplayPreferenceListener = () => {\n                            prefersReducedMotionQuery.removeEventListener('change', handleReducedMotionChange);\n                        };\n                    } else if (typeof prefersReducedMotionQuery.addListener === 'function') {\n                        prefersReducedMotionQuery.addListener(handleReducedMotionChange);\n                        cleanupAutoplayPreferenceListener = () => {\n                            prefersReducedMotionQuery.removeListener(handleReducedMotionChange);\n                        };\n                    }\n                }\n            }\n        }\n        \n        function preloadNeighboringImages(images, currentIndex) {\n            const nextIndex = (currentIndex + 1) % images.length;\n            const prevIndex = (currentIndex - 1 + images.length) % images.length;\n            \n            [nextIndex, prevIndex].forEach(index => {\n                const imageUrl = images[index]?.highResUrl;\n                if (imageUrl && !preloadedUrls.has(imageUrl)) {\n                    debug.log(mgaSprintf(mga__( \"Pr\u00E9chargement de l'image %s\", 'lightbox-jlg' ), index));\n                    const img = new Image();\n                    img.src = imageUrl;\n                    preloadedUrls.add(imageUrl);\n                }\n            });\n        }\n\n        function scheduleHeaderOffsetUpdate(viewer) {\n            if (!viewer || typeof pendingHeaderOffsetUpdates === 'undefined') {\n                return;\n            }\n\n            const previousFrame = pendingHeaderOffsetUpdates.get(viewer);\n\n            if (typeof previousFrame !== 'undefined') {\n                cancelFrame(previousFrame);\n            }\n\n            const frameId = scheduleFrame(() => {\n                pendingHeaderOffsetUpdates.delete(viewer);\n\n                const header = viewer.querySelector('.mga-header');\n\n                if (!header) {\n                    return;\n                }\n\n                const headerHeight = header.offsetHeight;\n\n                if (headerHeight > 0) {\n                    viewer.style.setProperty('--mga-header-offset', `${Math.ceil(headerHeight)}px`);\n                }\n            });\n\n            pendingHeaderOffsetUpdates.set(viewer, frameId);\n        }\n\n        function updateInfo(viewer, images, index) {\n            if (!viewer || !images[index]) {\n                return;\n            }\n\n            const captionContainer = viewer.querySelector('.mga-caption-container');\n            const captionElement = viewer.querySelector('#mga-caption');\n            const counterElement = viewer.querySelector('#mga-counter');\n            const liveRegion = captionContainer ? captionContainer.querySelector('.mga-caption-live') : null;\n            const feedbackElement = captionContainer ? captionContainer.querySelector('.mga-caption-feedback') : null;\n            const ctaContainer = viewer.querySelector('[data-mga-cta-container]');\n\n            const imageData = images[index];\n            const captionText = imageData.caption || '';\n            viewer.classList.toggle('mga-has-caption', Boolean(captionText));\n            const counterText = mgaSprintf(mga__( '%1$s / %2$s', 'lightbox-jlg' ), index + 1, images.length);\n            const announcementCounterText = mgaSprintf(mga__( 'Image %1$s sur %2$s', 'lightbox-jlg' ), index + 1, images.length);\n            const announcementText = captionText ? `${announcementCounterText}. ${captionText}` : announcementCounterText;\n\n            captionAnnouncementState.lastBaseAnnouncement = announcementText;\n\n            if (captionElement) {\n                captionElement.textContent = captionText;\n                captionElement.style.display = captionText ? '' : 'none';\n            }\n\n            if (counterElement) {\n                counterElement.textContent = counterText;\n            }\n\n            if (!captionAnnouncementState.isTemporaryMessageActive && liveRegion && liveRegion.textContent !== announcementText) {\n                liveRegion.textContent = announcementText;\n            }\n\n            if (!captionAnnouncementState.isTemporaryMessageActive && feedbackElement && !feedbackElement.hasAttribute('hidden')) {\n                feedbackElement.textContent = '';\n                feedbackElement.setAttribute('hidden', 'hidden');\n                feedbackElement.removeAttribute('data-mga-state');\n            }\n\n            const rawCtas = Array.isArray(imageData.ctas)\n                ? imageData.ctas\n                : (Array.isArray(imageData.ctaButtons) ? imageData.ctaButtons : []);\n            const effectiveCtas = showCtas ? rawCtas : [];\n\n            if (ctaContainer) {\n                while (ctaContainer.firstChild) {\n                    ctaContainer.removeChild(ctaContainer.firstChild);\n                }\n\n                if (effectiveCtas.length) {\n                    ctaContainer.removeAttribute('hidden');\n                    ctaContainer.setAttribute('role', 'group');\n                    ctaContainer.setAttribute('aria-label', mga__( 'Actions personnalis\u00E9es', 'lightbox-jlg' ));\n\n                    effectiveCtas.forEach((cta, ctaIndex) => {\n                        if (!cta || typeof cta !== 'object') {\n                            return;\n                        }\n\n                        const button = document.createElement('a');\n                        button.className = 'mga-cta-button';\n                        const variantClass = typeof cta.variant === 'string' && cta.variant.trim()\n                            ? ` mga-cta-button--${cta.variant.trim().toLowerCase()}`\n                            : ' mga-cta-button--primary';\n                        button.className += variantClass;\n                        button.textContent = cta.label || '';\n\n                        if (cta.url) {\n                            button.href = cta.url;\n                        } else {\n                            button.href = '#';\n                        }\n\n                        if (cta.target && cta.target !== '_self') {\n                            button.target = cta.target;\n                        }\n\n                        const relValue = cta.rel || (cta.target === '_blank' ? 'noopener noreferrer' : '');\n                        if (relValue) {\n                            button.rel = relValue;\n                        }\n\n                        button.setAttribute('data-mga-cta-index', String(ctaIndex));\n                        ctaContainer.appendChild(button);\n                    });\n                } else {\n                    ctaContainer.setAttribute('hidden', 'hidden');\n                    ctaContainer.removeAttribute('role');\n                    ctaContainer.removeAttribute('aria-label');\n                }\n            }\n\n            viewer.classList.toggle('mga-has-cta', showCtas && effectiveCtas.length > 0);\n\n            scheduleHeaderOffsetUpdate(viewer);\n\n            if (historyManager.isSupported && historyManager.isActive && historyManager.isActive()) {\n                historyManager.update(index);\n            }\n        }\n\n        function getCaptionElements(targetViewer) {\n            let viewer = targetViewer || null;\n            if (!viewer && typeof document !== 'undefined') {\n                viewer = document.getElementById('mga-viewer');\n            }\n            if (!viewer) {\n                return { captionContainer: null, liveRegion: null, feedbackElement: null };\n            }\n\n            const captionContainer = viewer.querySelector('.mga-caption-container');\n            if (!captionContainer) {\n                return { captionContainer: null, liveRegion: null, feedbackElement: null };\n            }\n\n            return {\n                captionContainer,\n                liveRegion: captionContainer.querySelector('.mga-caption-live'),\n                feedbackElement: captionContainer.querySelector('.mga-caption-feedback'),\n            };\n        }\n\n        function clearCaptionFeedback({ restoreBaseAnnouncement = true } = {}) {\n            if (captionFeedbackHideTimeout) {\n                clearTimeout(captionFeedbackHideTimeout);\n                captionFeedbackHideTimeout = null;\n            }\n\n            const { feedbackElement, liveRegion } = getCaptionElements();\n\n            if (feedbackElement) {\n                feedbackElement.textContent = '';\n                feedbackElement.setAttribute('hidden', 'hidden');\n                feedbackElement.removeAttribute('data-mga-state');\n            }\n\n            if (restoreBaseAnnouncement && liveRegion) {\n                liveRegion.textContent = captionAnnouncementState.lastBaseAnnouncement || '';\n            }\n\n            captionAnnouncementState.isTemporaryMessageActive = false;\n        }\n\n        function announceViewerFeedback(message, { tone = 'info', duration = 6000 } = {}) {\n            if (!message) {\n                clearCaptionFeedback();\n                return;\n            }\n\n            const { feedbackElement, liveRegion } = getCaptionElements();\n\n            if (!feedbackElement && !liveRegion) {\n                return;\n            }\n\n            if (captionFeedbackHideTimeout) {\n                clearTimeout(captionFeedbackHideTimeout);\n                captionFeedbackHideTimeout = null;\n            }\n\n            if (feedbackElement) {\n                feedbackElement.textContent = message;\n                feedbackElement.removeAttribute('hidden');\n                if (tone) {\n                    feedbackElement.setAttribute('data-mga-state', tone);\n                } else {\n                    feedbackElement.removeAttribute('data-mga-state');\n                }\n            }\n\n            if (liveRegion) {\n                liveRegion.textContent = message;\n            }\n\n            captionAnnouncementState.isTemporaryMessageActive = true;\n\n            if (duration > 0 && typeof window !== 'undefined' && typeof window.setTimeout === 'function') {\n                captionFeedbackHideTimeout = window.setTimeout(() => {\n                    clearCaptionFeedback();\n                }, duration);\n            }\n        }\n\n        document.body.addEventListener('click', function(e) {\n            const viewer = document.getElementById('mga-viewer');\n            if (!viewer || viewer.style.display === 'none') return;\n            const eventTarget = resolveEventTarget(e);\n            if (!eventTarget) {\n                return;\n            }\n            const clickedInsideViewer = viewer.contains(eventTarget);\n            const clickedInsideShareModal = Boolean(eventTarget.closest('.mga-share-modal'));\n            const clickedInsideMainSwiper = Boolean(eventTarget.closest('.mga-main-swiper'));\n            const clickedInsideHeader = Boolean(eventTarget.closest('.mga-header'));\n            const clickedInsideThumbs = Boolean(eventTarget.closest('.mga-thumbs-swiper'));\n\n            if (clickedInsideShareModal) {\n                // Keep the viewer open when interacting with the share modal (including its overlay).\n                return;\n            }\n\n            const clickedBackdropArea =\n                eventTarget === viewer ||\n                (clickedInsideViewer && !clickedInsideMainSwiper && !clickedInsideHeader && !clickedInsideThumbs);\n\n            if (clickedBackdropArea) {\n                if (closeOnBackdropClick) {\n                    closeViewer(viewer);\n                }\n                return;\n            }\n            if (eventTarget.closest('#mga-close')) {\n                closeViewer(viewer);\n                return;\n            }\n            if (eventTarget.closest('#mga-play-pause')) {\n                if (mainSwiper && mainSwiper.autoplay) {\n                    const autoplayInstance = mainSwiper.autoplay;\n                    const willRun = !autoplayInstance.running;\n                    if (willRun) {\n                        autoplayInstance.start();\n                    } else {\n                        autoplayInstance.stop();\n                    }\n                    updateAutoplayButtonState(viewer, willRun);\n                }\n            }\n            if (optionalToolbarHandlers.length) {\n                for (let i = 0; i < optionalToolbarHandlers.length; i += 1) {\n                    const handlerConfig = optionalToolbarHandlers[i];\n                    if (eventTarget.closest(handlerConfig.selector)) {\n                        handlerConfig.handler(e, viewer);\n                        return;\n                    }\n                }\n            }\n        });\n\n        document.addEventListener('keydown', (e) => {\n            const viewer = document.getElementById('mga-viewer');\n            if (!viewer || viewer.style.display === 'none') return;\n            switch (e.key) {\n                case 'Escape': closeViewer(viewer); break;\n                case 'ArrowLeft': if (mainSwiper) mainSwiper.slidePrev(); break;\n                case 'ArrowRight': if (mainSwiper) mainSwiper.slideNext(); break;\n            }\n        });\n\n        if (historyManager.isSupported && typeof window !== 'undefined' && typeof window.addEventListener === 'function') {\n            window.addEventListener('popstate', handleHistoryPop);\n        }\n\n        const handleSharePreferencesChange = (event) => {\n            const detail = event && typeof event.detail === 'object' && event.detail !== null\n                ? event.detail\n                : {};\n\n            if (Object.prototype.hasOwnProperty.call(detail, 'show_share')) {\n                showShare = normalizeFlag(detail.show_share, showShare);\n            } else if (Object.prototype.hasOwnProperty.call(detail, 'showShare')) {\n                showShare = normalizeFlag(detail.showShare, showShare);\n            }\n\n            if (Object.prototype.hasOwnProperty.call(detail, 'show_cta')) {\n                showCtas = normalizeFlag(detail.show_cta, showCtas);\n            } else if (Object.prototype.hasOwnProperty.call(detail, 'showCta')) {\n                showCtas = normalizeFlag(detail.showCta, showCtas);\n            }\n\n            if (Object.prototype.hasOwnProperty.call(detail, 'share_copy')) {\n                shareCopyEnabled = normalizeFlag(detail.share_copy, shareCopyEnabled);\n            } else if (Object.prototype.hasOwnProperty.call(detail, 'shareCopy')) {\n                shareCopyEnabled = normalizeFlag(detail.shareCopy, shareCopyEnabled);\n            }\n\n            if (Object.prototype.hasOwnProperty.call(detail, 'share_download')) {\n                shareDownloadEnabled = normalizeFlag(detail.share_download, shareDownloadEnabled);\n            } else if (Object.prototype.hasOwnProperty.call(detail, 'shareDownload')) {\n                shareDownloadEnabled = normalizeFlag(detail.shareDownload, shareDownloadEnabled);\n            }\n\n            if (Object.prototype.hasOwnProperty.call(detail, 'share_channels')) {\n                shareChannels = normalizeShareChannels(detail.share_channels);\n            } else if (Object.prototype.hasOwnProperty.call(detail, 'shareChannels')) {\n                shareChannels = normalizeShareChannels(detail.shareChannels);\n            }\n\n            syncShareControl();\n\n            const viewer = document.getElementById('mga-viewer');\n            if (viewer && currentGalleryImages && currentGalleryImages.length) {\n                const activeIndex = mainSwiper && !mainSwiper.destroyed\n                    ? mainSwiper.realIndex\n                    : 0;\n                updateInfo(viewer, currentGalleryImages, activeIndex);\n            }\n        };\n\n        const SHARE_PREFERENCES_EVENT = 'mga:share-preferences-change';\n        if (typeof window !== 'undefined') {\n            const previousHandler = window.__mgaSharePreferencesHandler__;\n            if (previousHandler && typeof window.removeEventListener === 'function') {\n                window.removeEventListener(SHARE_PREFERENCES_EVENT, previousHandler);\n            }\n\n            if (typeof window.addEventListener === 'function') {\n                window.addEventListener(SHARE_PREFERENCES_EVENT, handleSharePreferencesChange);\n                window.__mgaSharePreferencesHandler__ = handleSharePreferencesChange;\n            }\n        }\n\n        if (typeof module !== 'undefined' && module.exports) {\n            module.exports.__testExports = module.exports.__testExports || {};\n            module.exports.__testExports.openViewer = openViewer;\n            module.exports.__testExports.getViewer = getViewer;\n            module.exports.__testExports.getActiveHighResUrl = getActiveHighResUrl;\n            module.exports.__testExports.triggerImageDownload = triggerImageDownload;\n            module.exports.__testExports.openSharePanel = openSharePanel;\n            module.exports.__testExports.getActiveImageData = getActiveImageData;\n            module.exports.__testExports.getShareChannels = () => shareChannels;\n            module.exports.__testExports.getShareOptions = () => (shareModal && Array.isArray(shareModal.options)) ? shareModal.options : [];\n            module.exports.__testExports.syncShareControl = syncShareControl;\n        }\n\n        function closeViewer(viewer, options = {}) {\n            if (!viewer) {\n                return;\n            }\n\n            const skipHistory = Boolean(options && options.skipHistory);\n\n            if (!skipHistory && historyManager.isSupported && historyManager.isActive && historyManager.isActive()) {\n                const closedViaHistory = historyManager.beginClose();\n                if (closedViaHistory) {\n                    return;\n                }\n            }\n\n            const { exit: exitFullscreen, element: fullscreenElement } = resolveFullscreenApi(viewer);\n            if (fullscreenElement) {\n                if (exitFullscreen) {\n                    try {\n                        const result = exitFullscreen();\n                        if (result && typeof result.catch === 'function') {\n                            result.catch(err => debug.log(mgaSprintf(mga__( 'Erreur de sortie du plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true));\n                        }\n                    } catch (err) {\n                        debug.log(mgaSprintf(mga__( 'Erreur de sortie du plein \u00E9cran\u00A0: %s', 'lightbox-jlg' ), err.message), true);\n                    }\n                } else {\n                    debug.log(mga__( 'API de fermeture du plein \u00E9cran indisponible sur ce navigateur.', 'lightbox-jlg' ), true);\n                }\n            }\n            if(mainSwiper && mainSwiper.autoplay) {\n                mainSwiper.autoplay.stop();\n            }\n            closeShareModal({ restoreFocus: false, reason: 'viewer-close' });\n            resetShareModalFeedback();\n            clearCaptionFeedback({ restoreBaseAnnouncement: false });\n            if (typeof cleanupAutoplayPreferenceListener === 'function') {\n                cleanupAutoplayPreferenceListener();\n                cleanupAutoplayPreferenceListener = null;\n            }\n            thumbAccessibilityUpdater = null;\n            autoplayWasRunningBeforePreferenceChange = false;\n            window.removeEventListener('resize', handleResize);\n            isResizeListenerAttached = false;\n            if (viewerFocusTrapHandler) {\n                viewer.removeEventListener('keydown', viewerFocusTrapHandler, true);\n                viewerFocusTrapHandler = null;\n            }\n            viewer.style.display = 'none';\n            if (bodyPaddingRightWasModified) {\n                document.body.style.paddingRight = initialBodyPaddingRight;\n            }\n            if (bodyOverflowWasModified) {\n                document.body.style.overflow = initialBodyOverflow;\n            }\n            if (bodyScrollLockClassAdded) {\n                document.body.classList.remove(SCROLL_LOCK_CLASS);\n            }\n            initialBodyOverflow = null;\n            initialBodyPaddingRight = null;\n            bodyOverflowWasModified = false;\n            bodyPaddingRightWasModified = false;\n            bodyScrollLockClassAdded = false;\n            debug.log(mga__( 'Galerie ferm\u00E9e.', 'lightbox-jlg' ));\n            debug.stopTimer();\n            currentGalleryImages = [];\n            currentGalleryId = null;\n            if (historyManager.isSupported) {\n                historyManager.finalizeClose();\n            }\n            if (lastFocusedElementBeforeViewer && typeof lastFocusedElementBeforeViewer.focus === 'function') {\n                safeFocus(lastFocusedElementBeforeViewer);\n            }\n            lastFocusedElementBeforeViewer = null;\n        }\n\n        function handleResize() {\n            clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(() => {\n                if (mainSwiper && mainSwiper.el && !mainSwiper.destroyed) {\n                    const autoplayInstance = mainSwiper.autoplay;\n                    const wasRunning = Boolean(autoplayInstance && autoplayInstance.running);\n                    debug.log(mga__( 'Redimensionnement d\u00E9tect\u00E9. Mise \u00E0 jour de Swiper.', 'lightbox-jlg' ));\n                    mainSwiper.update();\n                    if(thumbsSwiper && !thumbsSwiper.destroyed) thumbsSwiper.update();\n                    if (wasRunning && mainSwiper.autoplay && typeof mainSwiper.autoplay.start === 'function') {\n                        mainSwiper.autoplay.start();\n                        debug.log(mga__( 'Autoplay relanc\u00E9 apr\u00E8s redimensionnement.', 'lightbox-jlg' ));\n                    }\n                }\n            }, 250);\n        }\n    }\n\n    const bootstrapGalleryViewer = () => {\n        ensureSwiper(window, { namespace: 'frontend' })\n            .catch((error) => {\n                if (window.console && typeof window.console.error === 'function') {\n                    window.console.error('[MGA] Swiper indisponible, utilisation du mode d\u00E9grad\u00E9.', error);\n                }\n            })\n            .finally(() => {\n                initGalleryViewer();\n            });\n    };\n\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', bootstrapGalleryViewer);\n    } else {\n        bootstrapGalleryViewer();\n    }\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports.updateEchoBackground = updateEchoBackground;\n        module.exports.updateAutoplayButtonState = updateAutoplayButtonState;\n    }\n})();\n"],
  "mappings": "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",
  "names": ["TOKEN_REGEX", "createFallbackSprintf", "createSprintf", "createTranslate", "resolveI18n", "getSharedI18n", "init_sprintf", "__esmMin", "format", "args", "autoIndex", "match", "position", "argIndex", "type", "numericIndex", "value", "coerced", "i18n", "text", "globalObject", "SHARE_ICON_LIBRARY", "sanitizeIconKey", "getDefinition", "createSvgElement", "createIconSvg", "init_icons", "__esmMin", "value", "iconKey", "sanitizedKey", "doc", "tag", "attributes", "element", "attribute", "definition", "svg", "pathDefinition", "path", "init_focus", "__esmMin", "getTimestamp", "getDocument", "getMetricsStore", "recordMetric", "normalizeAttempts", "loadStylesheet", "loadScript", "getLoaderState", "attemptLoad", "runAttemptsSequentially", "getConfig", "ensureSwiper", "init_swiper", "__esmMin", "global", "namespace", "event", "detail", "store", "customEvent", "error", "config", "attempt", "key", "js", "css", "inject", "jsSrc", "doc", "existing", "link", "resolve", "reject", "script", "timeoutId", "cleanup", "attempts", "promise", "explicitConfig", "options", "state", "init_shared", "__esmMin", "init_sprintf", "init_icons", "init_focus", "init_swiper", "require_gallery_slideshow", "__commonJSMin", "exports", "module", "init_shared", "mgaI18n", "getSharedI18n", "mga__", "createTranslate", "mgaSprintf", "createSprintf", "scheduleFrame", "callback", "cancelFrame", "id", "buildLabelFromKey", "key", "chunk", "createShareIconElement", "iconKey", "wrapper", "svg", "createIconSvg", "sanitizeIconKey", "normalizeShareChannels", "rawChannels", "entries", "channel", "candidate", "seenKeys", "accumulator", "entry", "rawKey", "label", "template", "icon", "enabled", "DEFAULT_EFFECT", "DEFAULT_SPEED", "DEFAULT_EASING", "ALLOWED_EFFECTS", "HEAVY_EFFECTS", "ALLOWED_EASINGS", "DEFAULT_THUMBS_LAYOUT", "ALLOWED_THUMBS_LAYOUTS", "sanitizeEffect", "rawEffect", "normalized", "sanitizeSpeed", "rawSpeed", "parsed", "sanitizeEasing", "rawEasing", "sanitizeThumbsLayout", "rawLayout", "applyTransitionEasing", "swiperInstance", "easing", "updateEchoBackground", "viewer", "imageUrl", "bgContainer", "sanitizedUrl", "oldImg", "newImg", "hasLoaded", "handleLoad", "swiperModulesRegistered", "registerSwiperModules", "modules", "registered", "updateAutoplayButtonState", "isRunning", "playPauseButton", "actionLabel", "initGalleryViewer", "settings", "thumbsLayout", "noop", "normalizeFlag", "value", "defaultValue", "includeSvg", "baseImagePattern", "imagePatternSource", "IMAGE_FILE_PATTERN", "isSvgLikeUrl", "url", "debug", "showZoom", "showDownload", "showShare", "showFullscreen", "showThumbsMobile", "showCtas", "closeOnBackdropClick", "loopEnabled", "startOnClickedImageSetting", "startOnClickedImage", "shareCopyEnabled", "shareDownloadEnabled", "shareChannels", "shareActionLabels", "resolveShareOptionsSnapshot", "options", "hasTemplate", "hasNativeShareSupport", "hasAnyShareActionAvailable", "shouldDisplayShareButton", "optionalToolbarHandlers", "SCROLL_LOCK_CLASS", "mainSwiper", "thumbsSwiper", "cleanupAutoplayPreferenceListener", "autoplayWasRunningBeforePreferenceChange", "preloadedUrls", "pendingHeaderOffsetUpdates", "resizeTimeout", "isResizeListenerAttached", "initialBodyOverflow", "initialBodyPaddingRight", "bodyOverflowWasModified", "bodyPaddingRightWasModified", "bodyScrollLockClassAdded", "lastFocusedElementBeforeViewer", "viewerFocusTrapHandler", "currentGalleryImages", "currentGalleryId", "shareModal", "shareModalIsOpen", "shareModalInvoker", "shareModalKeydownHandler", "thumbAccessibilityUpdater", "captionFeedbackHideTimeout", "captionAnnouncementState", "shareToolbarHandlerConfig", "event", "activeData", "getActiveImageData", "openSharePanel", "registerShareToolbarHandler", "updateToolbarOptionalButtons", "unregisterShareToolbarHandler", "index", "highResUrl", "getActiveHighResUrl", "triggerImageDownload", "requestFullscreen", "exitFullscreen", "fullscreenElement", "resolveFullscreenApi", "result", "err", "resolveEventTarget", "target", "fallbackIndex", "activeIndex", "activeImage", "image", "link", "fallbackName", "resolvedUrl", "pathname", "lastSegment", "innerError", "error", "toolbarElement", "toolbar", "createShareToolbarButton", "shareButton", "shareIcon", "sharePath", "ensureShareModal", "modalContainer", "overlay", "dialog", "header", "title", "closeButton", "body", "description", "list", "feedback", "onOverlayClick", "closeShareModal", "onCloseClick", "onShareModalListClick", "resetShareModalFeedback", "setShareModalFeedback", "message", "isError", "tone", "resolvedTone", "announceViewerFeedback", "populateShareModal", "modalInstance", "sharePayload", "option", "item", "button", "content", "iconElement", "labelSpan", "chevron", "buildShareOptions", "getShareModalFocusableElements", "focusableSelectors", "element", "onShareModalKeydown", "focusable", "first", "last", "activeElement", "openShareModal", "invokerButton", "restoreFocus", "reason", "shareButtonElement", "buildShareUrl", "payload", "replacements", "match", "copyToClipboard", "text", "resolve", "reject", "textarea", "successful", "trigger", "shareType", "shareKey", "shareLabel", "shareUrl", "popup", "shareResult", "imageData", "caption", "documentTitle", "syncShareControl", "shouldShow", "newShareButton", "fullscreenButton", "refreshedShareButton", "createSwiperInstance", "container", "config", "slidesCount", "maxSlidesPerView", "swiperConfig", "values", "collect", "bpConfig", "explicitLoopedSlides", "additionalSlides", "slidesPerGroup", "centeredSlidesBonus", "computedLoopedSlides", "minimumSlidesRequired", "safeConfig", "safeLoopedSlides", "safeAdditionalSlides", "remainingCapacity", "logMessage", "DEVICE_WIDTH_PRESETS", "isFiniteSlidesValue", "resolveSlidesPerViewSetting", "viewportWidth", "resolved", "breakpoints", "breakpoint", "breakpointConfig", "width", "a", "b", "buildSlidesVisibilitySummary", "preset", "reportSlidesVisibility", "swiper", "snapshot", "dynamicValue", "formatted", "slideToIndex", "targetIndex", "speed", "args", "focusSupportsOptionsCache", "detectFocusOptionsSupport", "testElement", "root", "safeFocus", "doc", "apiMap", "elementCandidates", "prop", "isExplicitFallbackAllowed", "linkElement", "allowFlag", "linkType", "rel", "dataType", "href", "baseHref", "getImageDataAttributes", "innerImg", "excludeLarge", "attributePriority", "datasetToAttributesMap", "collected", "attr", "datasetKey", "attributeName", "datasetValue", "largeKeys", "lightweightPreference", "preferredKey", "fallbackCandidate", "firstEntry", "sanitizeThumbnailUrl", "trimmed", "sanitizeHighResUrl", "location", "protocol", "resolveThumbnailUrl", "preferredSources", "source", "sanitized", "dataAttributeUrl", "parseSrcset", "parts", "candidateUrl", "score", "descriptor", "getHighResUrl", "isMediaHref", "fallbackAllowed", "sanitizedHref", "sanitizedDatasetUrl", "dataAttrUrl", "sanitizedDataAttrUrl", "srcsetUrl", "currentSrc", "fallbackSrc", "CTA_VARIANTS", "sanitizeCtaVariant", "sanitizeCtaTarget", "sanitizeCtaRel", "createCtaEntry", "raw", "variant", "parseCtaDefinitionList", "single", "readAttribute", "rawValue", "collectSingleCta", "prefix", "fallbackVariant", "variantAttribute", "extractCallToActions", "imageElement", "sources", "seen", "append", "node", "buildGalleryDataFromLinks", "triggerLinks", "thumbUrl", "fallbackThumbUrl", "figure", "figcaption", "ctas", "openViewerWithData", "galleryId", "galleryData", "startIndex", "sanitizedStartIndex", "focusOrigin", "capturedFocusElement", "historyConfig", "viewerOpened", "openViewer", "pendingDeepLink", "currentUrl", "separatorIndex", "encodedGalleryId", "slidePart", "slideNumber", "getViewer", "viewerTitle", "echoBg", "counter", "captionContainer", "captionLiveRegion", "captionFeedback", "ctaContainer", "timerSvg", "timerBgPath", "timerProgressPath", "playIcon", "playPath", "pauseIcon", "pausePath", "zoomButton", "zoomIcon", "zoomPrimaryPath", "zoomSecondaryPath", "downloadButton", "downloadIcon", "downloadArrow", "fullscreenIcon", "fullscreenPath", "closeIcon", "closePath", "mainWrapper", "nextButton", "prevButton", "thumbsWrapper", "defaultContentSelectors", "configuredSelectors", "contentSelectors", "contentArea", "foundSelector", "selector", "area", "errorMessage", "errorDetails", "FALLBACK_GROUP_ID", "configuredGroupAttribute", "REL_GROUP_PREFIX", "GENERIC_REL_TOKENS", "extractRelGroupToken", "relValue", "tokens", "token", "suffix", "resolveLinkGroupId", "relGroupToken", "attributeCandidates", "normalizedConfiguredGroupAttribute", "attrName", "hrefValue", "trimmedHref", "getTriggerLinks", "shouldUpdateDebug", "links", "grouped", "groupId", "groupCount", "summary", "sharedHelpers", "historyManager", "active", "lastIndex", "restoring", "originalUrl", "originalState", "buildViewerUrl", "targetGalleryId", "createState", "resolvedOriginalUrl", "resolvedOriginalState", "viewerUrl", "triggerObserverCleanup", "hasActiveObserver", "observer", "testImages", "previouslyFocusedElement", "eventTarget", "targetLink", "clickedHighResUrl", "groupedTriggerLinks", "clickedGroupId", "clickedTriggerIndex", "clickedImageIndex", "img", "handleHistoryPop", "state", "viewerState", "returnUrl", "closeViewer", "historyPayload", "clampedIndex", "updateInfo", "activeViewer", "images", "parsedStartIndex", "normalizedStartIndex", "historyOptionsRaw", "historyAction", "handleThumbNavigation", "updateThumbFocusState", "thumbButtons", "activeFound", "buttonIndex", "firstButton", "createThumbAriaLabel", "position", "slide", "spinner", "zoomContainer", "mainImg", "thumbSlide", "thumbButton", "thumbImg", "activateThumb", "targetButton", "initSwiper", "cancelMessage", "finalizeInitialState", "setupViewerFocusManagement", "previousOverflow", "previousPaddingRight", "computedPaddingRight", "bodyComputedStyle", "parsedPadding", "scrollbarWidth", "handleResize", "getFocusableViewerElements", "rect", "e", "currentIndex", "nextIndex", "sanitizedEffect", "sanitizedSpeed", "sanitizedEasing", "mainSwiperContainer", "thumbsSwiperContainer", "thumbsConfig", "thumbsMessage", "autoplayConfig", "prefersReducedMotionQuery", "prefersReducedMotion", "resolvedEffect", "resolvedSpeed", "enableCssMode", "shouldUseCssMode", "sanitizedInitialSlide", "handleAutoplayStart", "handleAutoplayStop", "progressCircle", "mainSwiperConfig", "preloadNeighboringImages", "s", "time", "progress", "originalInitHandler", "originalSetTransition", "targetSwiper", "mainMessage", "emitSlidesVisibilityUpdate", "params", "autoplayInstance", "hasAutoplayModule", "applyAutoplayParams", "paramsAutoplay", "originalAutoplay", "handleReducedMotionChange", "instance", "matchesReducedMotion", "targetEffect", "targetSpeed", "targetCssMode", "shouldResume", "prevIndex", "_a", "scheduleHeaderOffsetUpdate", "previousFrame", "frameId", "headerHeight", "captionElement", "counterElement", "liveRegion", "feedbackElement", "captionText", "counterText", "announcementCounterText", "announcementText", "rawCtas", "effectiveCtas", "cta", "ctaIndex", "variantClass", "getCaptionElements", "targetViewer", "clearCaptionFeedback", "restoreBaseAnnouncement", "duration", "clickedInsideViewer", "clickedInsideShareModal", "clickedInsideMainSwiper", "clickedInsideHeader", "clickedInsideThumbs", "willRun", "i", "handlerConfig", "handleSharePreferencesChange", "detail", "SHARE_PREFERENCES_EVENT", "previousHandler", "wasRunning", "bootstrapGalleryViewer", "ensureSwiper"]
}
